(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-73b2"],{NrYw:function(e,t,a){},SuGE:function(e,t,a){"use strict";var n=a("NrYw");a.n(n).a},qc7c:function(e,t,a){"use strict";a.r(t);var n=a("KglX"),r=a("ySi6"),o={name:"step_feedback_form",components:{Feedback:n.a},props:{file:{type:Object,required:!0}},data:function(){return{feedbackUpdateForm:{title:"",type:0,files:[],content:"",memo:""},feedbackUpdateRuleForm:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]}}},methods:{getFiles:function(e){e&&(this.feedbackUpdateForm.files=e)},getRTEContent:function(e){e&&(this.feedbackUpdateForm.content=e)},getFileType:function(e){e&&(this.feedbackUpdateForm.type=e)},handleCancelFeedback:function(){var e=this;this.$confirm("此操作将会重置当前表单并删除已上传的文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$message({type:"success",message:"已重置当前表单"})}).catch(function(){})},handleSubmitFeedback:function(){var e=this,t={};t.title=this.feedbackUpdateForm.title,t.type=this.file.type,t.memo=this.feedbackUpdateForm.memo,t.step_log_file_id=this.file.id,this.feedbackUpdateForm.files&&this.feedbackUpdateForm.files.length>0&&(t.files=this.feedbackUpdateForm.files.map(function(e){return e.url=e.raw_url||e.url,e})),this.feedbackUpdateForm.content&&(t.content=this.feedbackUpdateForm.content),this.$refs.feedbackUpdateValidateForm.validate(function(a){if(!a)return!1;Object(r.f)(t).then(function(t){200===t.code?(e.$message.success("反馈提交成功"),e.$refs.feedbackUpdateValidateForm.resetFields(),e.$listeners.getFeedbackLog(e.file),e.$refs.feedback.init()):console.log(t)}).catch(function(e){console.log(e)})})}}},i=(a("SuGE"),a("KHd+")),c=Object(i.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"feedbackUpdateValidateForm",attrs:{model:e.feedbackUpdateForm,rules:e.feedbackUpdateRuleForm}},[a("el-form-item",{attrs:{prop:"title",label:"标题","label-width":"80px"}},[a("el-input",{attrs:{type:"text",placeholder:""},model:{value:e.feedbackUpdateForm.title,callback:function(t){e.$set(e.feedbackUpdateForm,"title",t)},expression:"feedbackUpdateForm.title"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"",label:"上传文件","label-width":"80px"}},[a("Feedback",{ref:"feedback",attrs:{files:e.feedbackUpdateForm.files,content:e.feedbackUpdateForm.content},on:{getFiles:e.getFiles,getRTEContent:e.getRTEContent,getFileType:e.getFileType}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"memo",label:"备注","label-width":"80px"}},[a("el-input",{attrs:{type:"textarea",rows:1,placeholder:"备注"},model:{value:e.feedbackUpdateForm.memo,callback:function(t){e.$set(e.feedbackUpdateForm,"memo",t)},expression:"feedbackUpdateForm.memo"}})],1),e._v(" "),a("div",{staticClass:"footer"},[a("el-button",{on:{click:e.handleCancelFeedback}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmitFeedback}},[e._v("提 交")])],1)],1)},[],!1,null,"a22c0402",null);c.options.__file="step_feedback_form.vue";t.default=c.exports},ySi6:function(e,t,a){"use strict";a.d(t,"a",function(){return r}),a.d(t,"b",function(){return o}),a.d(t,"c",function(){return i}),a.d(t,"g",function(){return c}),a.d(t,"e",function(){return d}),a.d(t,"d",function(){return l}),a.d(t,"f",function(){return s});var n=a("t3Un");function r(e){return Object(n.a)({url:"api/v1/steps/",method:"post",data:e})}function o(e){return Object(n.a)({url:"api/v1/steps/"+e+"/",method:"delete"})}function i(e,t){return Object(n.a)({url:"api/v1/steps/"+e+"/",method:"put",data:t})}function c(e){return Object(n.a)({url:"api/v1/step/progress/update",method:"post",data:e})}function d(e){return Object(n.a)({url:"api/v1/step/progress/log",method:"get",params:e})}function l(e){return Object(n.a)({url:"api/v1/step/file/feedback/log",method:"get",params:e})}function s(e){return Object(n.a)({url:"api/v1/step/file/feedback/submit",method:"post",data:e})}}}]);