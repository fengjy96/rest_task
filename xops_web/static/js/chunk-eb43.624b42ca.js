(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-eb43"],{"0oZp":function(t,e,i){"use strict";i.r(e);var o=i("l9Yl"),s={props:{project_id:{type:Number,required:!0}},data:function(){return{project_cost:[],project_fee_cost:[],grossProfit:0,costGrossProfit:0,costFeeGrossProfit:0}},watch:{project_id:function(){this.init()},costGrossProfit:function(){this.grossProfit=this.costGrossProfit+this.costFeeGrossProfit,this.$store.dispatch("setProjectGrossProfit",this.grossProfit)},costFeeGrossProfit:function(){this.grossProfit=this.costGrossProfit+this.costFeeGrossProfit,this.$store.dispatch("setProjectGrossProfit",this.grossProfit)}},created:function(){this.init()},methods:{init:function(){var t=this;this.$nextTick(function(){t.getProjectCost(),t.getProjectFeeCost()})},getProjectCost:function(){var t=this,e={project_id:this.project_id};Object(o.k)(e).then(function(e){e&&200===e.code&&e.detail?t.project_cost=t.formatCostData(e.detail)||[]:t.project_cost=[]}).catch(function(t){console.log(t)})},getProjectFeeCost:function(){var t=this,e={project_id:this.project_id};Object(o.l)(e).then(function(e){e&&200===e.code&&e.detail?t.project_fee_cost=t.formatFeeCostData(e.detail)||[]:t.project_fee_cost=[]}).catch(function(t){console.log(t)})},formatCostData:function(t){var e=this;return t&&t.length>0&&t.forEach(function(t){t.person_nums=t.person_nums||"",t.user=t.user||"",t.duration=t.duration||"",t.name=t.name||"",t.fee=t.fee||0,t.total_fee=t.total_fee||0,2===t.type&&(t.fee=t.name||"",t.name="",e.costGrossProfit=t.total_fee||0)}),t},formatFeeCostData:function(t){var e=this;return t&&t.length>0&&t.forEach(function(t){t.person_nums=t.person_nums||"",t.user=t.user||"",t.duration=t.duration||"",t.name=t.name||"",t.fee=t.fee||0,t.total_fee=t.total_fee||0,2===t.type&&(t.fee=t.name||"",t.name="",e.costFeeGrossProfit=t.total_fee||0)}),t}}},r=(i("hVlz"),i("KHd+")),n=Object(r.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cost-analysis"},[i("div",[i("h3",[t._v("项目人员工资成本表")]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:t.project_cost}},[i("el-table-column",{attrs:{prop:"user",label:"姓名"}}),t._v(" "),i("el-table-column",{attrs:{prop:"person_nums",label:"人数"}}),t._v(" "),i("el-table-column",{attrs:{prop:"duration",label:"天数"}}),t._v(" "),i("el-table-column",{attrs:{prop:"fee",label:"平均工资（元）"}}),t._v(" "),i("el-table-column",{attrs:{prop:"total_fee",label:"成本（元）"}})],1)],1),t._v(" "),i("el-divider"),t._v(" "),i("div",[i("h3",[t._v("项目其它费用成本表")]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:t.project_fee_cost}},[i("el-table-column",{attrs:{prop:"name",label:"费用名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"person_nums",label:"人数"}}),t._v(" "),i("el-table-column",{attrs:{prop:"duration",label:"天数"}}),t._v(" "),i("el-table-column",{attrs:{prop:"fee",label:"费用（元）"}}),t._v(" "),i("el-table-column",{attrs:{prop:"total_fee",label:"成本（元）"}})],1)],1)],1)},[],!1,null,"3c22068a",null);n.options.__file="index.vue";e.default=n.exports},"3adm":function(t,e,i){},"4IyC":function(t,e,i){},"7E1t":function(t,e,i){"use strict";i.r(e);var o=i("0oZp"),s=i("QUGg"),r=i("dgj6"),n=i("l9Yl"),a={components:{cost:o.default,points_allocate:s.default,fee:r.default},props:{project_id:{type:Number||String,required:!0}},data:function(){return{active:1}},watch:{project_id:function(){this.init()}},methods:{prev:function(){this.active--<2&&(this.active=1)},next:function(){this.active++>2&&(this.active=3)},cancel:function(){},confirm:function(){var t=this,e={project_id:this.project_id};Object(n.d)(e).then(function(e){e&&200===e.code&&(t.$message.success("已完成项目成本分析！"),t.init(),t.$emit("switchDialogCostAnalysisVisible",!1))}).catch(function(t){console.log(t)})},init:function(){this.active=1}},created:function(){this.init()}},c=(i("GpXa"),i("KHd+")),l=Object(c.a)(a,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cost-analysis"},[i("div",{staticClass:"header"},[i("el-steps",{staticClass:"steps",attrs:{active:t.active,"align-center":""}},[i("el-step",{attrs:{title:"公摊费用管理",icon:"el-icon-edit",description:""}}),t._v(" "),i("el-step",{attrs:{title:"项目成本分析",icon:"el-icon-upload",description:""}}),t._v(" "),i("el-step",{attrs:{title:"项目积分分配",icon:"el-icon-picture",description:""}})],1)],1),t._v(" "),i("div",{staticClass:"container"},[1===t.active?i("fee",{attrs:{project_id:t.project_id}}):t._e(),t._v(" "),2===t.active?i("cost",{attrs:{project_id:t.project_id}}):t._e(),t._v(" "),3===t.active?i("points_allocate",{attrs:{project_id:t.project_id}}):t._e()],1),t._v(" "),i("div",{staticClass:"footer"},[i("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary",disabled:1===t.active},on:{click:t.prev}},[t._v("上一步")]),t._v(" "),i("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary",disabled:3===t.active},on:{click:t.next}},[t._v("下一步")]),t._v(" "),3===t.active?i("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]):t._e()],1)])},[],!1,null,"e776dc3c",null);l.options.__file="index.vue";e.default=l.exports},Dzt8:function(t,e,i){},GpXa:function(t,e,i){"use strict";var o=i("KVAg");i.n(o).a},IBqj:function(t,e,i){"use strict";i.r(e);var o=i("41Be"),s=(i("7Qib"),{components:{eForm:i("mSPi").default},props:{project_id:{type:[Number,String],required:!0}},data:function(){return{}},methods:{checkPermission:o.a,getDefaultFees:function(){this.$parent.getProjectFees(!0)}}}),r=(i("qWL5"),i("KHd+")),n=Object(r.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"head-container"},[i("div",{staticClass:"left"}),t._v(" "),i("div",{staticClass:"right"},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.getDefaultFees}},[t._v("生成默认费用\n      ")]),t._v(" "),i("div",{staticStyle:{display:"inline-block",margin:"0 2px"}},[i("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.$refs.form.dialog=!0}}},[t._v("新增\n      ")]),t._v(" "),i("eForm",{ref:"form",attrs:{project_id:t.project_id,"is-add":!0}})],1)],1)])},[],!1,null,"89c99138",null);n.options.__file="header.vue";e.default=n.exports},KVAg:function(t,e,i){},RLMI:function(t,e,i){"use strict";var o=i("pb67");i.n(o).a},dgj6:function(t,e,i){"use strict";i.r(e);var o=i("l9Yl"),s=i("41Be"),r=i("jwuY"),n=i("IBqj"),a={props:{project_id:{type:[Number,String],required:!0}},components:{edit:r.default,eHeader:n.default},data:function(){return{sup_this:this,Loading:!1,delLoading:!1,fees:[]}},watch:{project_id:function(){this.init()}},created:function(){this.init()},methods:{checkPermission:s.a,handleClick:function(t){console.log(t)},init:function(){var t=this;this.$nextTick(function(){t.getProjectFees()})},getProjectFees:function(){var t=this,e={is_first:arguments.length>0&&void 0!==arguments[0]&&arguments[0],project_id:this.project_id};Object(o.m)(e).then(function(e){e&&(t.fees=e||[])}).catch(function(t){console.log(t)})},formatData:function(t){return t&&t.length>0&&t.forEach(function(t){t.name=t.name||"",t.value=t.value||""}),t},subDelete:function(t){var e=this;this.delLoading=!0,Object(o.f)(t).then(function(i){e.delLoading=!1,e.$refs[t].doClose(),e.init(),e.$message({showClose:!0,type:"success",message:"删除成功!",duration:2500})}).catch(function(i){e.delLoading=!1,e.$refs[t].doClose(),console.log(i)})}}},c=(i("wLbd"),i("KHd+")),l=Object(c.a)(a,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"fee"},[i("div",{staticClass:"fee-container",staticStyle:{width:"70%",margin:"0 auto"}},[i("eHeader",{attrs:{project_id:t.project_id,fees:t.fees}}),t._v(" "),i("el-table",{staticClass:"fee-table",attrs:{border:"","highlight-current-row":"",fit:"",size:"small",data:t.fees}},[i("el-table-column",{attrs:{prop:"name",label:"费用名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"value",label:"费用"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("edit",{attrs:{data:e.row,sup_this:t.sup_this,project_id:t.project_id}}),t._v(" "),i("el-popover",{ref:e.row.id,attrs:{placement:"top",width:"180"}},[i("p",[t._v("确定删除本条数据吗？")]),t._v(" "),i("div",{staticStyle:{"text-align":"right",margin:"0"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.$refs[e.row.id].doClose()}}},[t._v("取消\n              ")]),t._v(" "),i("el-button",{attrs:{loading:t.Loading,type:"primary",size:"mini"},on:{click:function(i){t.subDelete(e.row.id)}}},[t._v("确定\n              ")])],1),t._v(" "),i("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[t._v("删除\n            ")])],1)]}}])})],1)],1)])},[],!1,null,"65e1873e",null);l.options.__file="index.vue";e.default=l.exports},hVlz:function(t,e,i){"use strict";var o=i("Dzt8");i.n(o).a},jwuY:function(t,e,i){"use strict";i.r(e);var o={components:{eForm:i("mSPi").default},props:{data:{type:Object,required:!0},sup_this:{type:Object,required:!0},project_id:{type:[Number,String],required:!0}},data:function(){return{}},methods:{to:function(){var t=this.$refs.form;t.form={id:this.data.id,name:this.data.name,value:this.data.value},t.dialog=!0}}},s=(i("RLMI"),i("KHd+")),r=Object(s.a)(o,function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("el-button",{attrs:{size:"mini",type:"success"},on:{click:this.to}},[this._v("编辑")]),this._v(" "),e("eForm",{ref:"form",attrs:{sup_this:this.sup_this,"is-add":!1,project_id:this.project_id}})],1)},[],!1,null,"52d21362",null);r.options.__file="edit.vue";e.default=r.exports},k3Pj:function(t,e,i){"use strict";var o=i("4IyC");i.n(o).a},mSPi:function(t,e,i){"use strict";i.r(e);var o=i("l9Yl"),s={props:{isAdd:{type:Boolean,required:!0},sup_this:{type:Object,default:null},project_id:{type:[Number,String],required:!0}},data:function(){return{managers:[],loading:!1,dialog:!1,form:{name:"",value:""},rules:{name:[{required:!0,message:"请输入费用名称",trigger:"blur"}],value:[{required:!0,message:"请输入费用金额",trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.loading=!0,t.isAdd?t.doAdd():t.doEdit()})},doAdd:function(){var t=this;this.form.project=this.project_id,Object(o.b)(this.form).then(function(e){t.resetForm(),t.$message({showClose:!0,type:"success",message:"添加成功!",duration:2500}),t.loading=!1,t.$parent.$parent.init()}).catch(function(e){t.loading=!1,console.log(e)})},doEdit:function(){var t=this;this.form.project=this.project_id,Object(o.i)(this.form.id,this.form).then(function(e){t.resetForm(),t.$message({showClose:!0,type:"success",message:"修改成功!",duration:2500}),t.loading=!1,t.sup_this.init()}).catch(function(e){t.loading=!1,console.log(e)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={}}}},r=(i("k3Pj"),i("KHd+")),n=Object(r.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{width:"480px","append-to-body":!0,visible:t.dialog,title:t.isAdd?"新增费用":"编辑费用"},on:{"update:visible":function(e){t.dialog=e}}},[i("el-form",{ref:"form",attrs:{size:"small","label-width":"96px",model:t.form,rules:t.rules}},[i("el-form-item",{attrs:{label:"费用名称",prop:"name"}},[i("el-input",{staticStyle:{width:"338px"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"费用金额",prop:"value"}},[i("el-input",{staticStyle:{width:"338px"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"text"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.doSubmit}},[t._v("确认")])],1)],1)},[],!1,null,"64bb9eb4",null);n.options.__file="form.vue";e.default=n.exports},pb67:function(t,e,i){},qWL5:function(t,e,i){"use strict";var o=i("t5+2");i.n(o).a},"t5+2":function(t,e,i){},wLbd:function(t,e,i){"use strict";var o=i("3adm");i.n(o).a}}]);