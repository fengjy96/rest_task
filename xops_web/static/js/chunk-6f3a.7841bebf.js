(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6f3a","chunk-155b"],{"+AWp":function(e,t,i){"use strict";i.r(t);var s=i("41Be"),a=i("yUYn"),o=i("dMq6"),l=i("lYL8"),r=i("qpJb"),n={components:{Feedback:i("KglX").a},props:{isAdd:{type:Boolean,required:!0},sup_this:{type:Object,default:null},project_id:{type:[Number,String],required:!0}},data:function(){return{activeNames:[],task_type:[],taskType:[{id:0,value:"角色原画",text:"角色原画"},{id:1,value:"场景原画",text:"场景原画"},{id:2,value:"3D模型",text:"3D模型"},{id:3,value:"动作(2D3D)",text:"动作(2D3D)"},{id:4,value:"特效(2D3D)",text:"特效(2D3D)"},{id:5,value:"修图",text:"修图"},{id:6,value:"视频剪辑",text:"视频剪辑"},{id:7,value:"UI",text:"UI"},{id:8,value:"平面设计",text:"平面设计"}],task_priorities:[],taskPriority:[{id:0,value:"特急"},{id:1,value:"紧急"},{id:2,value:"急"},{id:3,value:"普通"}],task_qualities:[],taskQuality:[{id:0,value:"A+"},{id:1,value:"A"},{id:2,value:"B+"},{id:3,value:"B"},{id:4,value:"C+"},{id:5,value:"C"}],managers:[],loading:!1,dialog:!1,taskStatus:[{value:"未安排任务负责人",text:"未安排任务负责人"},{value:"已安排任务负责人",text:"已安排任务负责人"},{value:"等待接手",text:"等待接手"},{value:"已接手",text:"已接手"},{value:"已完成",text:"已完成"},{value:"已拒接",text:"已拒接"}],form:{name:"",type:"",priority:"",quality:"",points:0,period:[],receiver_id:null,receiver_name:null,files:[],content:"",memo:""},rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],type:[{required:!0,message:"请输入任务类型",trigger:"blur"}],priority:[{required:!0,message:"请选择任务优先级",trigger:"blur"}],quality:[{required:!0,message:"请选择任务品质要求",trigger:"blur"}],manager:[{required:!0,message:"请选择任务负责人",trigger:"blur"}],period:[{required:!0,message:"请输入任务完成时间范围",trigger:"blur"}]}}},methods:{getFileType:function(e){e&&(this.form.type=e)},getFiles:function(e){console.log("val",e),e&&(this.form.files=e)},getRTEContent:function(e){e&&(this.form.content=e)},filterHandler:function(e,t,i){return t[i.property]===e},checkPermission:s.a,cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,e.isAdd?e.doAdd():e.doEdit()})},doAdd:function(){var e=this,t={name:this.form.name,task_type:this.form.type,task_priority:this.form.priority,points:this.form.points,task_quality:this.form.quality,receiver:this.form.receiver_id,content:this.form.content,type:this.form.type,memo:this.form.memo,begin_time:this.form.period[0],end_time:this.form.period[1],project:this.project_id};t.files=this.form.files.map(function(e){return e.url=e.raw_url||e.url,e}),Object(a.a)(t).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"添加成功!",duration:2500}),e.loading=!1,e.sup_this.init(),e.$refs.feedback.init()}).catch(function(t){e.loading=!1,console.log(t)})},doEdit:function(){var e=this,t={name:this.form.name,task_type:this.form.type,task_priority:this.form.priority,points:this.form.points,task_quality:this.form.quality,receiver:this.form.receiver_id,content:this.form.content,type:this.form.type,memo:this.form.memo,begin_time:this.form.period[0],end_time:this.form.period[1],project:this.form.project_id};t.files=this.form.files.map(function(e){return e.url=e.raw_url||e.url,e}),Object(a.c)(this.form.id,t).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"修改成功!",duration:2500}),e.loading=!1,e.sup_this.init(),e.$refs.feedback.init()}).catch(function(t){e.loading=!1,console.log(t)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={name:""},this.form.type=this.task_type[0].id,this.form.priority=this.task_priorities[0].id,this.form.quality=this.task_qualities[0].id,this.form.files=[]},getAllTaskManagers:function(){var e=this;Object(a.d)().then(function(t){e.managers=t.detail||[]})},open:function(){this.getAllTaskManagers()},getTaskTypes:function(){var e=this;Object(o.b)().then(function(t){t&&t.length>0?(e.task_type=t,e.form.type=t[0].id):e.task_type=[]}).catch(function(t){console.log(t),e.task_type=[]})},getTaskPriorities:function(){var e=this;Object(l.d)().then(function(t){t&&t.length>0?(e.task_priorities=t,e.form.priority=t[0].id):e.task_priorities=[]}).catch(function(t){console.log(t),e.task_priorities=[]})},getTaskQualities:function(){var e=this;Object(r.d)().then(function(t){t&&t.length>0?(e.task_qualities=t,e.form.quality=t[0].id):e.task_qualities=[]}).catch(function(t){console.log(t),e.task_qualities=[]})},init:function(){this.getTaskTypes(),this.getTaskPriorities(),this.getTaskQualities()}},created:function(){this.init()}},c=(i("JkCc"),i("KHd+")),d=Object(c.a)(n,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{width:"960px","append-to-body":!0,visible:e.dialog,title:e.isAdd?"新增任务":"编辑任务"},on:{"update:visible":function(t){e.dialog=t},open:e.open}},[i("el-form",{ref:"form",attrs:{size:"small","label-width":"96px",model:e.form,rules:e.rules}},[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[i("el-input",{staticStyle:{width:"338px"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"类型",prop:"type"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.task_type,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"优先级",prop:"priority"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.priority,callback:function(t){e.$set(e.form,"priority",t)},expression:"form.priority"}},e._l(e.task_priorities,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"品质要求",prop:"quality"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.quality,callback:function(t){e.$set(e.form,"quality",t)},expression:"form.quality"}},e._l(e.task_qualities,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),e.checkPermission(["admin","task_all","task_points_view","task_points_edit"])?i("el-form-item",{attrs:{label:"积分",prop:"points"}},[i("el-input",{staticStyle:{width:"338px"},model:{value:e.form.points,callback:function(t){e.$set(e.form,"points",t)},expression:"form.points"}})],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"时间范围",prop:"period"}},[i("el-date-picker",{staticStyle:{width:"338px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.form.period,callback:function(t){e.$set(e.form,"period",t)},expression:"form.period"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"任务负责人"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.receiver_id,callback:function(t){e.$set(e.form,"receiver_id",t)},expression:"form.receiver_id"}},e._l(e.managers,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"备注",prop:"memo"}},[i("el-input",{staticStyle:{width:"338px"},attrs:{type:"textarea"},model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("Feedback",{ref:"feedback",attrs:{files:e.form.files,content:e.form.content},on:{getFiles:e.getFiles,getRTEContent:e.getRTEContent,getFileType:e.getFileType}})],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)},[],!1,null,"e23a3a14",null);d.options.__file="form.vue";t.default=d.exports},103:function(e,t){},104:function(e,t){},"41Be":function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i("Q2AE");function a(e){if(e&&e instanceof Array&&e.length>0){var t=e;return!!(s.a.getters&&s.a.getters.roles).some(function(e){return t.includes(e)})}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},69:function(e,t){},JkCc:function(e,t,i){"use strict";var s=i("St6L");i.n(s).a},St6L:function(e,t,i){},UeQv:function(e,t,i){},afCY:function(e,t,i){"use strict";i.r(t);var s=i("4d7F"),a=i.n(s),o=i("41Be"),l=i("7Qib"),r=i("+AWp"),n=i("yUYn"),c=i("EUZL"),d=i.n(c),u={components:{eForm:r.default},props:{query:{type:Object,required:!0},project_id:{type:[Number,String]},sup_this:{type:Object,default:null},isDisableTaskCreate:{type:Boolean,default:!1},isDisableTaskPublish:{type:Boolean,default:!1},isDisableTaskImport:{type:Boolean,default:!1},isDisableTaskAssign:{type:Boolean,default:!1},selected_task_ids:{type:Array,default:[]}},data:function(){return{fileUploadUrl:"http://192.168.239.129/api/v1/files/upload",fileList:[],task_manager_id:null,taskManagers:[],dialogTaskAssignVisible:!1,dialogTaskImportVisible:!1,dialogTaskImportResultVisible:!1,project:{name:"",style:"",customer:"",manager:"",duration:"",begin_time:"",end_time:""},downloadLoading:!1,importResults:{success:0,fail:0,infos:[]}}},methods:{importExcel:function(e){var t=this,i=e.name.split("."),s=i[i.length-1],a=e.size/1024/1024<5,o=["xlsx","xlc","xlm","xls","xlt","xlw","csv"].some(function(e){return e===s});return o?a?(this.file2Xce(e).then(function(e){e&&e.length>0&&(t.xlsxJson=e)}),a&&o):(this.$message.error("上传的文件大小不能超过 5MB!"),!1):(this.$message.error("格式错误! 只能上传 excel 文件!"),!1)},file2Xce:function(e){return new a.a(function(t,i){var s=new FileReader;s.onload=function(e){var i=this,s=e.target.result;this.wb=d.a.read(s,{type:"binary"});var a=[];this.wb.SheetNames.forEach(function(e){a.push({sheetName:e,sheet:d.a.utils.sheet_to_json(i.wb.Sheets[e])})}),t(a)},s.readAsBinaryString(e.raw)})},handleBeforeUpload:function(e){},handleRemove:function(e,t){console.log(e,t)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){},handleSuccess:function(e,t){if(200===e.code&&e.detail&&e.detail.files&&e.detail.files.length>0){var i,s=[];e.detail.files.forEach(function(e){var t=e.url,i=e.url,a=e.name;s.push({name:a,url:t,raw_url:i})}),(i=this.fileList).push.apply(i,s),this.$message.success("文件上传成功")}},checkPermission:o.a,toQuery:function(){this.$parent.page=1,this.$parent.init()},download:function(){var e=this;this.downloadLoading=!0,i.e("chunk-8725").then(i.bind(null,"S/jZ")).then(function(t){var i=e.formatJson(["id","name","desc","index","weight"],e.$parent.data);t.export_json_to_excel({header:["ID","名称","描述","序号","权重"],data:i,filename:"table-list"}),e.downloadLoading=!1})},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return"createTime"===e?Object(l.b)(t[e]):t[e]})})},handleTaskPublish:function(){var e=this;if(this.selected_task_ids.length>0){var t={project_id:this.project_id,selected_task_ids:this.selected_task_ids};Object(n.m)(t).then(function(t){t&&200===t.code&&(e.$message.success("发布成功！"),e.sup_this.init())}).catch(function(e){console.log(e)})}else this.$message.error("请先勾选需要发布的任务！")},handleOpenAssignDialog:function(){this.selected_task_ids.length>0?(this.dialogTaskAssignVisible=!0,this.getTaskManagers()):this.$message.error("请先勾选需要指派的任务！")},handleTaskAssign:function(){var e=this,t={task_ids:this.selected_task_ids,receiver_id:this.task_manager_id};Object(n.h)(t).then(function(t){t&&200===t.code&&(e.dialogTaskAssignVisible=!1,e.$message.success("指派成功！"),e.sup_this.init(),e.task_manager_id=null)}).catch(function(e){console.log(e)})},getTaskManagers:function(){var e=this;Object(n.d)().then(function(t){t&&200===t.code&&t.detail&&t.detail.length>0&&(e.taskManagers=t.detail||[])}).catch(function(e){console.log(e)})},handleTaskImport:function(){var e=this,t={project_id:this.project_id,files:this.fileList};Object(n.l)(t).then(function(t){t&&200===t.code&&(e.dialogTaskImportVisible=!1,e.importResults=t.detail,e.dialogTaskImportResultVisible=!0,e.sup_this.init(),e.fileList=[])}).catch(function(e){console.log(e)})}},created:function(){this.project=this.$store.state.project.project,this.project&&(this.project.name=this.project.name||"",this.project.style=this.project.style||"",this.project.customer=this.project.customer||"",this.project.manager=this.project.receiver?this.project.receiver.name:"",this.project.duration=Math.abs(new Date(this.project.end_time)-new Date(this.project.begin_time))/864e5+1||"",this.project.begin_time=this.project.begin_time||"",this.project.end_time=this.project.end_time||"")}},p=(i("va6R"),i("KHd+")),m=Object(p.a)(u,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"head-container"},[""!==e.project_id?i("div",{staticClass:"task-head"},[i("div",{staticClass:"left"},[i("el-form",{staticClass:"project",attrs:{"label-position":"right","label-width":"120px",inline:"",size:"mini",model:e.project}},[i("div",{staticClass:"project-detail"},[i("el-form-item",{attrs:{label:"项目名称："}},[i("span",[e._v(e._s(e.project.name))])]),e._v(" "),i("el-form-item",{attrs:{label:"风格："}},[i("span",[e._v(e._s(e.project.style))])]),e._v(" "),i("el-form-item",{attrs:{label:"客户："}},[i("span",[e._v(e._s(e.project.customer))])])],1),e._v(" "),i("div",{staticClass:"project-detail"},[i("el-form-item",{attrs:{label:"项目负责人："}},[i("span",[e._v(e._s(e.project.manager))])]),e._v(" "),i("el-form-item",{attrs:{label:"时限（天）："}},[i("span",[e._v(e._s(e.project.duration))])]),e._v(" "),i("el-form-item",{attrs:{label:"开始时间："}},[i("span",[e._v(e._s(e.project.begin_time))])]),e._v(" "),i("el-form-item",{attrs:{label:"结束时间："}},[i("span",[e._v(e._s(e.project.end_time))])])],1)])],1),e._v(" "),i("div",{staticClass:"right"},[e.checkPermission(["admin","task_all","task_batch_allocate"])?i("el-button",{staticClass:"filter-item",attrs:{disabled:e.isDisableTaskAssign,size:"mini",type:"primary"},on:{click:e.handleOpenAssignDialog}},[e._v("指派\n      ")]):e._e(),e._v(" "),e.checkPermission(["admin","task_all","task_publish"])?i("el-button",{staticClass:"filter-item",attrs:{disabled:e.isDisableTaskPublish,size:"mini",type:"primary"},on:{click:e.handleTaskPublish}},[e._v("发布\n      ")]):e._e(),e._v(" "),i("div",{staticStyle:{display:"inline-block",margin:"0 2px"}},[e.checkPermission(["admin","task_all","task_create"])?i("el-button",{staticClass:"filter-item",attrs:{disabled:e.isDisableTaskCreate,size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.$refs.form.dialog=!0}}},[e._v("新增\n        ")]):e._e(),e._v(" "),i("eForm",{ref:"form",attrs:{sup_this:e.sup_this,"is-add":!0,project_id:e.project_id}})],1),e._v(" "),e.checkPermission(["admin","task_all","task_import"])?i("el-button",{staticClass:"filter-item",attrs:{disabled:e.isDisableTaskImport,loading:e.downloadLoading,size:"mini",type:"primary",icon:"el-icon-download"},on:{click:function(t){e.dialogTaskImportVisible=!0}}},[e._v("导入\n      ")]):e._e(),e._v(" "),e.checkPermission(["admin","task_all","task_export"])?i("el-button",{staticClass:"filter-item",attrs:{loading:e.downloadLoading,size:"mini",type:"primary",icon:"el-icon-download"},on:{click:e.download}},[e._v("导出\n      ")]):e._e()],1)]):e._e(),e._v(" "),i("el-dialog",{attrs:{width:"450px",visible:e.dialogTaskAssignVisible},on:{"update:visible":function(t){e.dialogTaskAssignVisible=t}}},[i("el-select",{attrs:{placeholder:"请选择",value:""},model:{value:e.task_manager_id,callback:function(t){e.task_manager_id=t},expression:"task_manager_id"}},e._l(e.taskManagers,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogTaskAssignVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleTaskAssign}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"导入任务",width:"450px",visible:e.dialogTaskImportVisible},on:{"update:visible":function(t){e.dialogTaskImportVisible=t}}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:e.fileUploadUrl,"before-upload":e.handleBeforeUpload,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,limit:1,"on-exceed":e.handleExceed,"on-change":e.importExcel,"on-success":e.handleSuccess,"file-list":e.fileList,accept:".xls,.xlsx",drag:"",multiple:""}},[i("i",{staticClass:"el-icon-upload"}),e._v(" "),i("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),i("em",[e._v("点击上传")])]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传 excel 文件")])]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogTaskImportVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleTaskImport}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"导入结果",width:"600px",visible:e.dialogTaskImportResultVisible},on:{"update:visible":function(t){e.dialogTaskImportResultVisible=t}}},[i("div",{staticClass:"import-result"},[i("div",{staticClass:"success"},[e._v("有 "+e._s(this.importResults.success)+" 条数据导入成功")]),e._v(" "),i("div",{staticClass:"success"},[e._v("有 "+e._s(this.importResults.fail)+" 条数据导入失败")]),e._v(" "),i("el-divider"),e._v(" "),i("div",{staticClass:"fail-info"},[i("el-row",e._l(this.importResults.infos,function(t,s){return i("el-col",{key:s,staticClass:"fail-item"},[e._v(e._s(t.info)+"\n          ")])}))],1)],1)])],1)},[],!1,null,"233d0b1e",null);m.options.__file="header.vue";t.default=m.exports},va6R:function(e,t,i){"use strict";var s=i("UeQv");i.n(s).a}}]);