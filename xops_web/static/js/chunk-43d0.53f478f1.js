(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-43d0","chunk-46c8","chunk-0d77","chunk-0803","chunk-2b2e","chunk-473c","chunk-6525","chunk-67f0"],{"+Jyj":function(e,t,i){},"3ADX":function(e,t,i){"use strict";var a=i("14Xm"),s=i.n(a),r=i("4d7F"),n=i.n(r),o=i("D3Ub"),l=i.n(o),c=i("t3Un");function u(e,t,i){return Object(c.a)({url:e,method:"get",params:t,isMock:i})}var d=i("LvDl"),p=i.n(d);t.a={data:function(){return{loading:!0,rawData:[],data:[],page:1,size:10,total:0,url:"",params:{},query:{},time:170}},methods:{init:p.a.throttle(function(){var e=l()(s.a.mark(function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.beforeInit();case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new n.a(function(e,a){t.loading=!0,u(t.url,t.params,i).then(function(i){t.total=i.count,t.rawData=i.results,t.data=t.afterInit?t.afterInit(i.results):t.rawData,setTimeout(function(){t.loading=!1},t.time),e(i)}).catch(function(e){t.loading=!1,a(e)})}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),1e3),beforeInit:function(){return!0},pageChange:function(e){this.page=e,this.init()},sizeChange:function(e){this.page=1,this.size=e,this.init()}}}},"41Be":function(e,t,i){"use strict";i.d(t,"a",function(){return s});var a=i("Q2AE");function s(e){if(e&&e instanceof Array&&e.length>0){var t=e;return!!(a.a.getters&&a.a.getters.roles).some(function(e){return t.includes(e)})}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},"623q":function(e,t,i){"use strict";var a=i("pMCq");i.n(a).a},"7pTL":function(e,t,i){"use strict";i.r(t);var a=i("F9iD"),s=i("wd/R"),r=i.n(s),n={name:"reject_reason",props:{row:{type:Object,required:!0},reason_type:{type:Object,required:!0}},data:function(){return{title:"",reasons:[]}},methods:{getRejectReason:function(){var e=this,t={link_id:this.row.id,type_id:this.reason_type.id};Object(a.b)(t).then(function(t){e.reasons=t?e.formatData(t):[]}).catch(function(e){console.log(e)})},formatData:function(e){return e&&e.length>0&&e.forEach(function(e){e.reason=e.reason||"",e.add_time=e.add_time?r()(e.add_time).format("YYYY-MM-DD hh:mm"):"",e.transfer_nums=e.transfer_nums||"",e.sender_name=e.sender?e.sender.name:""}),e}}},o=(i("pYNO"),i("KHd+")),l=Object(o.a)(n,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-popover",{attrs:{title:e.reason_type.text,width:"600",placement:"top",trigger:"hover"},on:{show:function(t){e.getRejectReason(e.row)}}},[i("el-table",{attrs:{data:e.reasons}},[i("el-table-column",{attrs:{label:"时间",prop:"add_time",width:"150"}}),e._v(" "),i("el-table-column",{attrs:{label:"次数",prop:"transfer_nums",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{label:"原因",prop:"reason","show-overflow-tooltip":!0}}),e._v(" "),i("el-table-column",{attrs:{label:"发送者",prop:"sender_name",width:"120","show-overflow-tooltip":!0}})],1),e._v(" "),i("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[e._t("footer")],2)],1)},[],!1,null,"644c2187",null);l.options.__file="reject_reason.vue";t.default=l.exports},"9jzK":function(e,t,i){"use strict";i.r(t);var a=i("PL5b"),s=i("g8L3"),r={name:"step_file_preview",props:{file:{type:Object,required:!0}},components:{image_preview:a.a,rte_preview:s.a},data:function(){return{}},watch:{file:{deep:!0,handler:function(){}}},methods:{handleDownload:function(){}},created:function(){}},n=(i("SQ63"),i("KHd+")),o=Object(n.a)(r,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"step-file-preview"},[i("el-button",{staticClass:"download",attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.handleDownload(t)}}},[1===e.file.type?i("a",{attrs:{target:"_blank",href:e.file.path,download:e.file.name}},[e._v("下载\n    ")]):e._e()]),e._v(" "),i("div",[1===e.file.type?i("image_preview",{attrs:{src:e.file.path}}):i("rte_preview",{attrs:{content:e.file.content}})],1)],1)},[],!1,null,"1fc88271",null);o.options.__file="file_preview.vue";t.default=o.exports},A1Yv:function(e,t,i){"use strict";i.d(t,"d",function(){return s}),i.d(t,"a",function(){return r}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o});var a=i("t3Un");function s(e){return Object(a.a)({url:"api/v1/task_design_types/",method:"get",params:e})}function r(e){return Object(a.a)({url:"task/design_type/",method:"post",data:e})}function n(e){return Object(a.a)({url:"task/design_type/"+e+"/",method:"delete"})}function o(e,t){return Object(a.a)({url:"task/design_type/"+e+"/",method:"put",data:t})}},DgwL:function(e,t,i){"use strict";i.r(t);var a={components:{eForm:i("IGqm").default},props:{data:{type:Object,required:!0},sup_this:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},data:function(){return{project_id:""}},methods:{to:function(){var e=this.$refs.form;e.form={id:this.data.id,name:this.data.name,type:this.data.task_type?this.data.task_type.id:"",priority:this.data.task_priority?this.data.task_priority.id:"",quality:this.data.task_quality?this.data.task_quality.id:"",points:this.data.points,period:[this.data.begin_time,this.data.end_time],receiver_id:this.data.receiver?this.data.receiver.id:"",receiver_name:this.data.receiver?this.data.receiver.name:"",files:this.data.files,content:this.data.content,memo:this.data.memo,project_id:this.data.project?this.data.project.id:""},e.dialog=!0,this.project_id=this.data.project?this.data.project.id:""}}},s=(i("623q"),i("KHd+")),r=Object(s.a)(a,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-button",{attrs:{disabled:e.disabled,size:"mini",type:"success"},on:{click:function(t){return t.stopPropagation(),e.to(t)}}},[e._v("编辑\n  ")]),e._v(" "),i("eForm",{ref:"form",attrs:{sup_this:e.sup_this,"is-add":!1,project_id:e.project_id}})],1)},[],!1,null,"56d0fa90",null);r.options.__file="edit.vue";t.default=r.exports},EM0K:function(e,t,i){},F9iD:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"b",function(){return r});var a=i("t3Un");function s(){return Object(a.a)({url:"api/v1/reason_types",method:"get"})}function r(e){return Object(a.a)({url:"api/v1/reasons",method:"get",params:e})}},IGqm:function(e,t,i){"use strict";i.r(t);var a=i("41Be"),s=i("yUYn"),r=i("dMq6"),n=i("lYL8"),o=i("qpJb"),l={components:{Feedback:i("KglX").a},props:{isAdd:{type:Boolean,required:!0},sup_this:{type:Object,default:null},project_id:{type:[Number,String],required:!0}},data:function(){return{activeNames:[],dialogTableVisible:!1,task_type:[],taskType:[{id:0,value:"角色原画",text:"角色原画"},{id:1,value:"场景原画",text:"场景原画"},{id:2,value:"3D模型",text:"3D模型"},{id:3,value:"动作(2D3D)",text:"动作(2D3D)"},{id:4,value:"特效(2D3D)",text:"特效(2D3D)"},{id:5,value:"修图",text:"修图"},{id:6,value:"视频剪辑",text:"视频剪辑"},{id:7,value:"UI",text:"UI"},{id:8,value:"平面设计",text:"平面设计"}],task_priorities:[],taskPriority:[{id:0,value:"特急"},{id:1,value:"紧急"},{id:2,value:"急"},{id:3,value:"普通"}],task_qualities:[],taskQuality:[{id:0,value:"A+"},{id:1,value:"A"},{id:2,value:"B+"},{id:3,value:"B"},{id:4,value:"C+"},{id:5,value:"C"}],managers:[],loading:!1,dialog:!1,taskStatus:[{value:"未安排任务负责人",text:"未安排任务负责人"},{value:"已安排任务负责人",text:"已安排任务负责人"},{value:"等待接手",text:"等待接手"},{value:"已接手",text:"已接手"},{value:"已完成",text:"已完成"},{value:"已拒接",text:"已拒接"}],form:{name:"",type:"",priority:"",quality:"",points:0,period:[],receiver_id:"",receiver_name:"",files:[],content:"",memo:""},rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],type:[{required:!0,message:"请输入任务类型",trigger:"blur"}],priority:[{required:!0,message:"请选择任务优先级",trigger:"blur"}],quality:[{required:!0,message:"请选择任务品质要求",trigger:"blur"}],manager:[{required:!0,message:"请选择任务负责人",trigger:"blur"}],period:[{required:!0,message:"请输入任务完成时间范围",trigger:"blur"}]}}},methods:{getFileType:function(e){e&&(this.form.type=e)},getFiles:function(e){console.log("val",e),e&&(this.form.files=e)},getRTEContent:function(e){e&&(this.form.content=e)},filterHandler:function(e,t,i){return t[i.property]===e},checkPermission:a.a,cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,e.isAdd?e.doAdd():e.doEdit()})},doAdd:function(){var e=this,t={name:this.form.name,task_type:this.form.type,task_priority:this.form.priority,points:this.form.points,task_quality:this.form.quality,receiver:this.form.receiver_id,content:this.form.content,type:this.form.type,memo:this.form.memo,begin_time:this.form.period[0],end_time:this.form.period[1],project:this.project_id};t.files=this.form.files.map(function(e){return e.url=e.raw_url||e.url,e}),Object(s.a)(t).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"添加成功!",duration:2500}),e.loading=!1,e.sup_this.init(),e.$refs.feedback.init()}).catch(function(t){e.loading=!1,console.log(t)})},doEdit:function(){var e=this,t={name:this.form.name,task_type:this.form.type,task_priority:this.form.priority,points:this.form.points,task_quality:this.form.quality,receiver:this.form.receiver_id,content:this.form.content,type:this.form.type,memo:this.form.memo,begin_time:this.form.period[0],end_time:this.form.period[1],project:this.form.project_id};t.files=this.form.files.map(function(e){return e.url=e.raw_url||e.url,e}),Object(s.c)(this.form.id,t).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"修改成功!",duration:2500}),e.loading=!1,e.sup_this.init(),e.$refs.feedback.init()}).catch(function(t){e.loading=!1,console.log(t)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={name:""},this.form.type=this.task_type[0].id,this.form.priority=this.task_priorities[0].id,this.form.quality=this.task_qualities[0].id,this.form.files=[]},getAllTaskManagers:function(){var e=this;Object(s.d)().then(function(t){e.managers=t.detail,e.managers.length>0&&e.managers.forEach(function(t){t.name=t.name||"-",t.task_type=t.task_type||"-",t.task_name=t.task_name||"-",t.progress=0===t.task_progress?"0%":t.task_progress?t.task_progress+"%":"-",t.end_time=t.end_time||"-",t.left_days=""!==t.leftdays?t.leftdays:"-",t.task_status=""!==t.receive_status?e.taskStatus[t.receive_status]:"-"})})},open:function(){console.log("this.form",this.form),this.getAllTaskManagers()},selectTaskReceiver:function(e){e&&(this.form.receiver_name=e.name||"-",this.form.receiver_id=e.user_id||"-",this.dialogTableVisible=!1)},getTaskTypes:function(){var e=this;Object(r.b)().then(function(t){t&&t.length>0?(e.task_type=t,e.form.type=t[0].id):e.task_type=[]}).catch(function(t){console.log(t),e.task_type=[]})},getTaskPriorities:function(){var e=this;Object(n.d)().then(function(t){t&&t.length>0?(e.task_priorities=t,e.form.priority=t[0].id):e.task_priorities=[]}).catch(function(t){console.log(t),e.task_priorities=[]})},getTaskQualities:function(){var e=this;Object(o.d)().then(function(t){t&&t.length>0?(e.task_qualities=t,e.form.quality=t[0].id):e.task_qualities=[]}).catch(function(t){console.log(t),e.task_qualities=[]})},init:function(){this.getTaskTypes(),this.getTaskPriorities(),this.getTaskQualities()}},created:function(){this.init()}},c=(i("REHs"),i("KHd+")),u=Object(c.a)(l,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{width:"70%","append-to-body":!0,visible:e.dialog,title:e.isAdd?"新增任务":"编辑任务"},on:{"update:visible":function(t){e.dialog=t},open:e.open}},[i("el-form",{ref:"form",attrs:{size:"small","label-width":"96px",model:e.form,rules:e.rules}},[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[i("el-input",{staticStyle:{width:"338px"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"类型",prop:"type"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.task_type,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"优先级",prop:"priority"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.priority,callback:function(t){e.$set(e.form,"priority",t)},expression:"form.priority"}},e._l(e.task_priorities,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"品质要求",prop:"quality"}},[i("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.quality,callback:function(t){e.$set(e.form,"quality",t)},expression:"form.quality"}},e._l(e.task_qualities,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),e.checkPermission(["admin","task_all","task_points_view","task_points_edit"])?i("el-form-item",{attrs:{label:"积分",prop:"points"}},[i("el-input",{staticStyle:{width:"338px"},model:{value:e.form.points,callback:function(t){e.$set(e.form,"points",t)},expression:"form.points"}})],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"时间范围",prop:"period"}},[i("el-date-picker",{staticStyle:{width:"338px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.form.period,callback:function(t){e.$set(e.form,"period",t)},expression:"form.period"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"任务负责人"}},[i("el-input",{staticStyle:{width:"338px"},attrs:{disabled:"",placeholder:"请选择任务负责人"},model:{value:e.form.receiver_name,callback:function(t){e.$set(e.form,"receiver_name",t)},expression:"form.receiver_name"}},[i("el-button",{attrs:{slot:"append"},on:{click:function(t){e.dialogTableVisible=!0}},slot:"append"},[e._v("...")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"备注",prop:"memo"}},[i("el-input",{staticStyle:{width:"338px"},attrs:{type:"textarea"},model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("Feedback",{ref:"feedback",attrs:{files:e.form.files,content:e.form.content},on:{getFiles:e.getFiles,getRTEContent:e.getRTEContent,getFileType:e.getFileType}})],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogTableVisible,"append-to-body":""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[i("el-table",{attrs:{"highlight-current-row":"",data:e.managers},on:{"row-dblclick":e.selectTaskReceiver}},[i("el-table-column",{attrs:{property:"name",label:"姓名","show-overflow-tooltip":!0}}),e._v(" "),i("el-table-column",{attrs:{property:"task_type",label:"任务类型",filters:e.taskType,"filter-method":e.filterHandler}}),e._v(" "),i("el-table-column",{attrs:{property:"task_name",label:"任务名称"}}),e._v(" "),i("el-table-column",{attrs:{property:"end_time",sortable:"",label:"结束时间"}}),e._v(" "),i("el-table-column",{attrs:{property:"left_days",sortable:"",label:"剩余天数"}}),e._v(" "),i("el-table-column",{attrs:{property:"progress",sortable:"",label:"进度",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{property:"task_status",label:"任务状态",filters:e.taskStatus,"filter-method":e.filterHandler,"show-overflow-tooltip":!0}}),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){e.selectTaskReceiver(t.row)}}},[e._v("选择")])]}}])})],1)],1)],1)},[],!1,null,"17f13b54",null);u.options.__file="form.vue";t.default=u.exports},IfqL:function(e,t,i){"use strict";var a=i("EM0K");i.n(a).a},"Po/4":function(e,t,i){"use strict";var a=i("ueDa");i.n(a).a},REHs:function(e,t,i){"use strict";var a=i("+Jyj");i.n(a).a},SQ63:function(e,t,i){"use strict";var a=i("ltq+");i.n(a).a},Stiw:function(e,t,i){"use strict";i.d(t,"d",function(){return s}),i.d(t,"a",function(){return r}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o});var a=i("t3Un");function s(){return Object(a.a)({url:"api/v1/task_assessments/",method:"get"})}function r(e){return Object(a.a)({url:"api/task/assessment/",method:"post",data:e})}function n(e){return Object(a.a)({url:"api/task/assessment/"+e+"/",method:"delete"})}function o(e,t){return Object(a.a)({url:"api/task/assessment/"+e+"/",method:"put",data:t})}},T7WI:function(e,t,i){"use strict";i.r(t);var a={name:"file_ref_log",components:{file_table:i("gtZP").default},props:{logs:{type:Array,required:!0}}},s=(i("sZhL"),i("KHd+")),r=Object(s.a)(a,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{},[t("el-timeline",{},this._l(this.logs,function(e,i){return t("el-timeline-item",{key:e.id,staticClass:"log-item",attrs:{timestamp:e.add_time,placement:"top",type:0===i?"primary":""}},[t("el-card",[t("file_table",{attrs:{files:e.files}})],1)],1)}))],1)},[],!1,null,"5e5e624c",null);r.options.__file="file_ref_log.vue";t.default=r.exports},VRWe:function(e,t,i){},"XA+L":function(e,t,i){},c4Vh:function(e,t,i){},gtZP:function(e,t,i){"use strict";i.r(t);var a=i("9jzK"),s=i("PL5b"),r=i("g8L3"),n={name:"step_file_table",components:{image_preview:s.a,rte_preview:r.a,file_preview:a.default},props:{files:{type:Array,default:function(){return[]}}},data:function(){return{expands:[],src:"",type:"",content:"",file:""}},methods:{handlePreview:function(e){var t=window.open("","预览","width=500, height=300");1===e.type?t.document.write('<img src="'+e.path+'" alt=""/>'):0===e.type&&t.document.write(e.content)},getRowKeys:function(e){return e.name+e.id},handleExpandChange:function(e,t){var i=this;t.length>1&&this.files.forEach(function(t){t.id!==e.id&&i.$refs.tables.toggleRowExpansion(t,!1)})},handleRowClick:function(e,t,i){this.$refs.tables.toggleRowExpansion(e)}}},o=(i("uQJ4"),i("KHd+")),l=Object(o.a)(n,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-table",{ref:"tables",staticStyle:{width:"100%"},attrs:{data:e.files,border:"","highlight-current-row":"",size:"small",fit:"","expand-row-keys":e.expands,"row-key":e.getRowKeys},on:{"expand-change":e.handleExpandChange,"row-click":e.handleRowClick}},[i("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("div",[i("file_preview",{attrs:{file:e.row}})],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"文件名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"type_name",label:"类型"}}),e._v(" "),i("el-table-column",{attrs:{prop:"add_time",label:"提交时间"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){i.stopPropagation(),e.handlePreview(t.row)}}},[e._v("预览")])]}}])})],1)],1)},[],!1,null,"4e6af71f",null);l.options.__file="file_table.vue";t.default=l.exports},lrNY:function(e,t,i){"use strict";i.r(t);var a=i("41Be"),s={components:{eForm:i("IGqm").default},props:{query:{type:Object,required:!0},sup_this:{type:Object,default:null}},data:function(){return{taskTypes:[],taskQualities:[],taskPriorities:[],checkedTaskTypeIds:[],checkedTaskPriorityIds:[],checkedTaskQualityIds:[],skills:[]}},created:function(){this.init()},watch:{checkedTaskTypeIds:function(){this.handleCheckedTaskTypesChange(this.checkedTaskTypeIds)}},methods:{checkPermission:a.a,toQuery:function(){this.sup_this.page=1,this.sup_this.init()},init:function(){this.taskTypes=this.$store.state.task.types||[],this.taskPriorities=this.$store.state.task.priorities||[],this.taskQualities=this.$store.state.task.qualities||[],this.skills=this.$store.state.user.skills||[],this.checkedTaskTypeIds=this.skills.map(function(e){return e.id}),this.handleCheckedTaskTypesChange(this.checkedTaskTypeIds)},refresh:function(){this.sup_this.init()},handleCheckedTaskTypesChange:function(e){e&&(this.query.task_type_ids=e.join()),this.toQuery()},handleCheckedTaskPrioritiesChange:function(e){e&&(this.query.task_priority_ids=e.join()),this.toQuery()},handleCheckedTaskQualitiesChange:function(e){e&&(this.query.task_quality_ids=e.join()),this.toQuery()}}},r=(i("IfqL"),i("KHd+")),n=Object(r.a)(s,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"head-container"},[i("el-form",{attrs:{"label-position":"right","label-width":"100px"}},[i("el-form-item",{attrs:{label:"任务类型："}},[i("el-checkbox-group",{attrs:{size:"mini"},on:{change:e.handleCheckedTaskTypesChange},model:{value:e.checkedTaskTypeIds,callback:function(t){e.checkedTaskTypeIds=t},expression:"checkedTaskTypeIds"}},e._l(e.taskTypes,function(t){return i("el-checkbox-button",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name)+"\n        ")])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"优先级："}},[i("el-checkbox-group",{attrs:{size:"mini"},on:{change:e.handleCheckedTaskPrioritiesChange},model:{value:e.checkedTaskPriorityIds,callback:function(t){e.checkedTaskPriorityIds=t},expression:"checkedTaskPriorityIds"}},e._l(e.taskPriorities,function(t){return i("el-checkbox-button",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name)+"\n        ")])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"品质要求："}},[i("el-checkbox-group",{attrs:{size:"mini"},on:{change:e.handleCheckedTaskQualitiesChange},model:{value:e.checkedTaskQualityIds,callback:function(t){e.checkedTaskQualityIds=t},expression:"checkedTaskQualityIds"}},e._l(e.taskQualities,function(t){return i("el-checkbox-button",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name)+"\n        ")])}))],1)],1),e._v(" "),i("div",{staticClass:"btn_wrapper"},[i("el-button",{staticClass:"refresh",attrs:{type:"primary"},on:{click:e.refresh}},[e._v("刷新\n    ")])],1)],1)},[],!1,null,"3f1a571d",null);n.options.__file="header.vue";t.default=n.exports},"ltq+":function(e,t,i){},nApJ:function(e,t,i){},pMCq:function(e,t,i){},pYNO:function(e,t,i){"use strict";var a=i("c4Vh");i.n(a).a},paJy:function(e,t,i){"use strict";var a=i("nApJ");i.n(a).a},sZhL:function(e,t,i){"use strict";var a=i("VRWe");i.n(a).a},uQJ4:function(e,t,i){"use strict";var a=i("XA+L");i.n(a).a},ueDa:function(e,t,i){},xoKi:function(e,t,i){"use strict";i.r(t);var a=i("QbLZ"),s=i.n(a),r=i("41Be"),n=i("3ADX"),o=i("yUYn"),l=i("Stiw"),c=i("7Qib"),u=i("lrNY"),d=i("DgwL"),p=i("A1Yv"),f=i("7pTL"),m=i("T7WI"),h=i("wd/R"),_=i.n(h),v={components:{eHeader:u.default,edit:d.default,reject_reason:f.default,file_ref_log:m.default},mixins:[n.a],data:function(){return{skills:[],selected_task_ids:[],project:null,task_id:"",logs:[],value:"",taskAssessments:[],options:[],reasonType:[],reasonTypeMap:null,dialogTaskCheckPassVisible:!1,dialogTaskCheckRejectVisible:!1,taskCheckRejectReason:"",isCheckSubmitVisible:!1,taskStatusMap:null,activeName:"all",expands:[],taskRejectReason:"",designType:"",designTypes:[],dialogFileVisible:!1,dialogTaskAcceptVisible:!1,dialogTaskRejectVisible:!1,dialogTaskTransferVisible:!1,dialogTableVisible:!1,fileData:[],Loading:!1,publishStatus:[{value:"未发布",text:"未发布"},{value:"已发布",text:"已发布"}],taskStatus:[{value:"未安排任务负责人",text:"未安排任务负责人"},{value:"已安排任务负责人",text:"已安排任务负责人"},{value:"等待接手",text:"等待接手"},{value:"已接手",text:"已接手"},{value:"已完成",text:"已完成"},{value:"已拒接",text:"已拒接"}],auditStatus:[{value:"未审核",text:"未审核"},{value:"审核中",text:"审核中"},{value:"已审核",text:"已审核"},{value:"已驳回",text:"已驳回"}],taskPriority:[{text:"特急",value:"特急"},{text:"紧急",value:"紧急"},{text:"急",value:"急"},{text:"普通",value:"普通"}],taskType:[{text:"角色原画",value:"角色原画"},{text:"场景原画",value:"场景原画"},{text:"3D模型",value:"3D模型"},{text:"动作(2D3D)",value:"动作(2D3D)"},{text:"特效(2D3D)",value:"特效(2D3D)"},{text:"修图",value:"修图"},{text:"视频剪辑",value:"视频剪辑"},{text:"UI",value:"UI"},{text:"平面设计",value:"平面设计"}],delLoading:!1,sup_this:this,tasks:[],project_id:"",managers:[],transfer_form:{manager:"",memo:""},transfer_rules:{manager:[{required:!0,message:"请选择任务负责人",trigger:"blur"}]},TaskCheckPassForm:{task_assessment:"",remark:""},TaskCheckPassFormRules:{task_assessment:[{required:!0,message:"请为该任务作为评价",trigger:"blur"}]}}},created:function(){var e=this;this.project=this.$store.state.project.project,this.initTask(),this.$nextTick(function(){e.query.is_published=1,e.query.has_receiver=0,e.size=10,e.activeName?e.getData(e.activeName):e.init()})},methods:{isDisableTaskAccept:function(e){var t=!0,i=[];return this.skills.map(function(e){i.push(e.id)}),e&&e.task_type&&e.task_type.id&&-1!==i.indexOf(e.task_type.id)&&(t=!1),t},initTask:function(){this.getTaskAssessments(),this.initStatus(),this.skills=this.$store.state.user.skills||[]},initStatus:function(){this.getTaskStatus()},getTaskStatus:function(){var e=this;Object(o.f)().then(function(t){t&&t.length>0?(e.taskStatus=t,e.taskStatusMap=e.arrayToMap(t,"key"),e.taskStatus.forEach(function(e){e.value=e.text})):e.taskStatus=[]}).catch(function(e){console.log(e)})},arrayToMap:function(e,t){if(e&&e.length>0){var i={};return e.map(function(e,a){t?i[e[t]]=e:i[e[a]]=e}),i}},getData:function(e){"all"===e||("wait_publish"===e?this.query.is_published=0:"published"===e?this.query.is_published=1:this.taskStatusMap&&this.taskStatusMap[e]&&(this.query.receive_status=this.taskStatusMap[e].id)),this.init()},parseTime:c.b,checkPermission:r.a,beforeInit:function(){this.url="api/v1/tasks/";var e=this.query,t=e.value;return this.params=s()({page:this.page,size:this.size,ordering:"id"},e),t&&(this.params.search=t),!0},afterInit:function(e){return this.formatData(e)},filterHandler:function(e,t,i){return t[i.property]===e},formatData:function(e){return e&&e.length>0&&e.forEach(function(e){e.name=e.name||"",e.project_name=e.project?e.project.name:"",e.type=e.task_type?e.task_type.name:"",e.design_type=e.design_type?e.design_type.name:"",e.priority=e.task_priority?e.task_priority.name:"",e.quality=e.task_quality?e.task_quality.name:"",e.begin_time=e.begin_time?_()(e.begin_time).format("YYYY-MM-DD"):"",e.end_time=e.end_time?_()(e.end_time).format("YYYY-MM-DD"):"",e.publish_time=e.publish_time?_()(e.publish_time).format("YYYY-MM-DD"):"",e.finish_time=e.finish_time?_()(e.finish_time).format("YYYY-MM-DD"):"",e.finish_time?(e.delta_time=_()(e.end_time).diff(_()(e.finish_time),"days"),e.delta_time>0?e.lead_time=Math.abs(e.delta_time):e.delay_time=Math.abs(e.delta_time)):(e.delta_time=_()(e.end_time).diff(_()(),"days"),e.delta_time<0&&(e.delay_time=Math.abs(e.delta_time))),e.duration=Math.abs(new Date(e.end_time)-new Date(e.begin_time))/864e5+1,e.progress=(e.progress||0)+"%",e.task_status_text=e.receive_status?e.receive_status.text:"",e.publish_status=0===e.is_published?"未发布":"已发布",e.assessment=e.assessment?e.assessment.name:"",e.comments=e.comments||"",e.memo=e.memo||"",e.content=e.content||"",e.points=e.points||0,e.project_manager=e.sender?e.sender.name:"",e.task_manager=e.receiver?e.receiver.name:"",e.files=e.files||[],e.files.length&&e.files.forEach(function(e){e.name=e.file_name||"",e.create_time=e.file_date||"",e.url=e.file_url||""})}),e},open:function(e,t,i,a){var s=this;if(1===i)this.dialogFileVisible=!0,this.fileData=e;else if(2===i){this.dialogTaskAcceptVisible=!0;var r={task_type_id:a.row.task_type.id};Object(p.d)(r).then(function(e){s.designTypes=e,s.designTypes.length&&(s.designType=s.designTypes[0].name),s.task_id=a.row.id})}else"content"===i?this.handlePreview(e):"ref_files"===i?(this.getTaskRefFileLog(a.row.id),this.dialogFileVisible=!0):this.$confirm(e,t+"详情",{distinguishCancelAndClose:!0})},handlePreview:function(e){var t=window.open("","预览","width=500, height=300");e&&t.document.write(e)},handleTaskAccept:function(e){var t=this;e===this.designTypes[0].name&&(this.designType=this.designTypes[0].id);var i={task_id:this.task_id,task_design_type_id:this.designType};Object(o.g)(i).then(function(e){t.$message.success("接手成功"),t.dialogTaskAcceptVisible=!1,t.init()})},cancel:function(){this.resetForm(),this.dialogTaskTransferVisible=!1},resetForm:function(){this.dialog=!1,this.$refs.transfer_form.resetFields(),this.transfer_form={}},getRowKeys:function(e){return e.id},handleExpandChange:function(e,t){var i=this;t.length>1&&this.data.forEach(function(t){t.id!==e.id&&i.$refs.tables.toggleRowExpansion(t,!1)})},handleRowClick:function(e,t,i){this.$refs.tables.toggleRowExpansion(e)},tableRowClassName:function(e){var t=e.row,i=(e.rowIndex,"");switch(t.task_priority.name){case"特急":i="danger-row";break;case"紧急":i="warning-row"}return i},getTaskAssessments:function(){var e=this;Object(l.d)().then(function(t){e.taskAssessments=t&&t||[]}).catch(function(e){console.log(e)})},getTaskRefFileLog:function(e){var t=this,i={task_id:e};Object(o.e)(i).then(function(e){e&&200===e.code&&e.detail?t.logs=t.formatTaskRefFileLogData(e.detail)||[]:t.logs=[]}).catch(function(e){console.log(e)})},formatTaskRefFileLogData:function(e){return e&&e.length>0&&e.forEach(function(e){e.add_time=e.add_time?_()(e.add_time).format("YYYY-MM-DD hh:mm:ss"):"",e.files&&e.files.length>0&&e.files.forEach(function(t){t.path=t.path?"http://192.168.239.129"+t.path:t.path,e.content=e.content||"",t.type_name=1===t.type?"富文本":"图片",t.add_time=t.add_time?_()(t.add_time).format("YYYY-MM-DD hh:mm:ss"):"",t.name=t.name||"-"})}),e}}},k=(i("Po/4"),i("paJy"),i("KHd+")),b=Object(k.a)(v,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("eHeader",{staticStyle:{clear:"both"},attrs:{tasks:e.tasks,query:e.query,sup_this:e.sup_this}}),e._v(" "),i("el-container",{staticStyle:{clear:"both"}},[i("el-main",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tables",staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",size:"small",fit:"","row-class-name":e.tableRowClassName,data:e.data,"expand-row-keys":e.expands,"row-key":e.getRowKeys},on:{"expand-change":e.handleExpandChange,"row-click":e.handleRowClick}},[i("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-form",{staticClass:"table-expand task-detail",attrs:{size:"mini"}},[i("div",{staticClass:"task-detail-left"},[i("el-form-item",{attrs:{label:"任务名称："}},[i("span",[e._v(e._s(t.row.name))])]),e._v(" "),i("el-form-item",{attrs:{label:"所属项目："}},[i("span",[e._v(e._s(t.row.project_name))])]),e._v(" "),i("el-form-item",{attrs:{label:"类型："}},[i("span",[e._v(e._s(t.row.type))])]),e._v(" "),i("el-form-item",{attrs:{label:"设计方式："}},[i("span",[e._v(e._s(t.row.design_type))])]),e._v(" "),i("el-form-item",{attrs:{label:"优先级："}},[i("span",[e._v(e._s(t.row.priority))])]),e._v(" "),i("el-form-item",{attrs:{label:"品质要求："}},[i("span",[e._v(e._s(t.row.quality))])]),e._v(" "),i("el-form-item",{attrs:{label:"任务负责人："}},[i("span",[e._v(e._s(t.row.task_manager))])])],1),e._v(" "),i("div",{staticClass:"task-detail-right"},[i("el-form-item",{attrs:{label:"时限（天）："}},[i("span",[e._v(e._s(t.row.duration))])]),e._v(" "),1===e.query.receive_status?i("el-form-item",{attrs:{label:"完成进度："}},[i("span",[e._v(e._s(t.row.progress))])]):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"开始时间："}},[i("span",[e._v(e._s(t.row.begin_time))])]),e._v(" "),i("el-form-item",{attrs:{label:"结束时间："}},[i("span",[e._v(e._s(t.row.end_time))])]),e._v(" "),i("el-form-item",{attrs:{label:"项目负责人："}},[i("span",[e._v(e._s(t.row.project_manager))])]),e._v(" "),i("el-form-item",{attrs:{label:"任务状态："}},[i("span",[e._v(e._s(t.row.task_status_text))])]),e._v(" "),i("el-form-item",{attrs:{label:"备注："}},[i("el-button",{attrs:{type:"text"},on:{click:function(i){e.open(t.row.memo,"备注")}}},[e._v("点击显示备注详情")])],1),e._v(" "),i("el-form-item",{attrs:{label:"参考文件："}},[i("el-button",{attrs:{type:"text"},on:{click:function(i){e.open("参考文件","","ref_files",t)}}},[e._v("点击显示参考文件详情")])],1)],1)])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"任务名称","show-overflow-tooltip":!0}}),e._v(" "),i("el-table-column",{attrs:{prop:"type",label:"任务类型",filters:e.taskType,"filter-method":e.filterHandler}}),e._v(" "),i("el-table-column",{attrs:{prop:"priority",label:"优先级",filters:e.taskPriority,"filter-method":e.filterHandler}}),e._v(" "),i("el-table-column",{attrs:{prop:"quality",label:"品质要求","min-width":"100",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"begin_time",label:"开始时间","min-width":"100",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"points",label:"积分","min-width":"80",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"end_time",label:"结束时间","min-width":"100",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"publish_time",label:"发布时间","min-width":"100",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"duration",label:"时限（天）","min-width":"110",sortable:""}}),e._v(" "),""!==e.project_id?i("el-table-column",{attrs:{prop:"task_manager",label:"任务负责人","show-overflow-tooltip":!0}}):e._e(),e._v(" "),i("el-table-column",{attrs:{label:"任务状态",filters:e.taskStatus,"filter-method":e.filterHandler,"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return["accepted"===t.row.receive_status.key?i("span",[e._v("\n              "+e._s(t.row.receive_status.text)+"\n              "),t.row.delay_time?i("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("过期"+e._s(t.row.delay_time)+"天")]):e._e()],1):"finished"===t.row.receive_status.key||"wait_check"===t.row.receive_status.key||"check_reject"===t.row.receive_status.key||"checked"===t.row.receive_status.key?i("span",[e._v("\n              "+e._s(t.row.receive_status.text)+"\n              "),t.row.lead_time?i("el-tag",{attrs:{size:"small",type:"success"}},[e._v("提前"+e._s(t.row.lead_time)+"天")]):t.row.delay_time?i("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("过期"+e._s(t.row.delay_time)+"天")]):e._e()],1):"rejected"!==t.row.receive_status.key&&"check_rejected"!==t.row.receive_status.key?i("span",[e._v("\n              "+e._s(t.row.receive_status.text)+"\n            ")]):i("span",[i("reject_reason",{attrs:{row:t.row,reason_type:"rejected"===t.row.receive_status.key?e.reasonTypeMap.task_reject:e.reasonTypeMap.task_check_reject}},[i("span",{attrs:{slot:"footer"},slot:"footer"},[e._v("\n                  "+e._s(t.row.receive_status.text)+"\n                  "),i("i",{staticClass:"el-icon-info"})])])],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",fixed:"right",width:"220",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{disabled:e.isDisableTaskAccept(t.row),size:"mini",plain:"",type:"primary"},on:{click:function(i){i.stopPropagation(),e.open(0,"设计类型",2,t)}}},[e._v("接任务\n            ")]),e._v(" "),i("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(e){e.stopPropagation()}}},[e._v("分享\n            ")])]}}])})],1),e._v(" "),i("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{total:e.total,"page-sizes":[10,20,30,50,100],layout:"total, prev, pager, next, sizes"},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"参考文件",width:"70%",visible:e.dialogFileVisible},on:{"update:visible":function(t){e.dialogFileVisible=t}}},[i("file_ref_log",{attrs:{logs:e.logs}})],1),e._v(" "),i("el-dialog",{attrs:{width:"450px",visible:e.dialogTaskAcceptVisible},on:{"update:visible":function(t){e.dialogTaskAcceptVisible=t}}},[e._v("\n    设计方式：\n    "),i("el-select",{attrs:{placeholder:"请选择",value:""},model:{value:e.designType,callback:function(t){e.designType=t},expression:"designType"}},e._l(e.designTypes,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogTaskAcceptVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleTaskAccept(e.designType)}}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"4c4f2fb4",null);b.options.__file="index.vue";t.default=b.exports}}]);