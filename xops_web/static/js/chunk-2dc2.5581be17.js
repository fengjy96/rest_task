(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2dc2","chunk-46c8"],{"0DB/":function(e,t,a){"use strict";var i=a("UUqD");a.n(i).a},"3+Tn":function(e,t,a){},"4erX":function(e,t,a){},"6oA6":function(e,t,a){},"7pTL":function(e,t,a){"use strict";a.r(t);var i=a("F9iD"),s=a("wd/R"),o=a.n(s),r={name:"reject_reason",props:{row:{type:Object,required:!0},reason_type:{type:Object,required:!0}},data:function(){return{title:"",reasons:[]}},methods:{getRejectReason:function(){var e=this,t={link_id:this.row.id,type_id:this.reason_type.id};Object(i.b)(t).then(function(t){e.reasons=t?e.formatData(t):[]}).catch(function(e){console.log(e)})},formatData:function(e){return e&&e.length>0&&e.forEach(function(e){e.reason=e.reason||"",e.add_time=e.add_time?o()(e.add_time).format("YYYY-MM-DD hh:mm"):"",e.transfer_nums=e.transfer_nums||"",e.sender_name=e.sender?e.sender.name:""}),e}}},n=(a("pYNO"),a("KHd+")),l=Object(n.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",{attrs:{title:e.reason_type.text,width:"600",placement:"top",trigger:"hover"},on:{show:function(t){e.getRejectReason(e.row)}}},[a("el-table",{attrs:{data:e.reasons}},[a("el-table-column",{attrs:{label:"时间",prop:"add_time",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"次数",prop:"transfer_nums",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"原因",prop:"reason","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"发送者",prop:"sender_name",width:"120","show-overflow-tooltip":!0}})],1),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[e._t("footer")],2)],1)},[],!1,null,"644c2187",null);l.options.__file="reject_reason.vue";t.default=l.exports},Cmeg:function(e,t,a){"use strict";a.r(t);var i=a("QbLZ"),s=a.n(i),o=a("41Be"),r=a("3ADX"),n=a("l9Yl"),l=a("twU4"),c=a("F9iD"),u=a("7Qib"),d=a("SkD+"),p=a("qynV"),_=a("wd/R"),m=a.n(_),f=a("7pTL"),h=a("7E1t"),b={components:{eHeader:d.default,edit:p.default,reject_reason:f.default,cost_analysis:h.default},mixins:[r.a],data:function(){return{rejectReason:"",dialogProjectRejectVisible:!1,selectedTaskIds:[],dialogProjectCostAnalysisVisible:!1,reasonType:[],reasonTypeMap:null,reasons:[],projectStatusMap:null,activeName:"auditing",expands:[],projectAuditRejectReason:"",sender_id:"",project_id:"",auditor:"",auditors:[],dialogProjectAuditSubmitVisible:!1,dialogProjectAuditPassVisible:!1,dialogProjectAuditRejectVisible:!1,dialogProjectIssueVisible:!1,Loading:!1,auditStatus:[],projectStatus:[],delLoading:!1,sup_this:this,projects:[]}},computed:{},created:function(){var e=this;this.$nextTick(function(){e.getReasonTypes(),e.setDefaultActiveTab(),e.size=10,e.initStatus(),e.activeName?e.getData(e.activeName):e.init()})},methods:{isDisableProjectEdit:function(e){var t=!0;if(e&&e.receive_status)switch(e.receive_status.key){case"unassigned":case"assigned":case"wait_accept":case"rejected":this.checkPermission(["admin","role_all","role_business_manager"])&&(t=!1)}return t},isDisableProjectDelete:function(e){var t=!0;if(e&&e.receive_status)switch(e.receive_status.key){case"unassigned":case"assigned":case"wait_accept":case"rejected":this.checkPermission(["admin","role_all","role_business_manager"])&&(t=!1)}return t},isDisableProjectAuditSubmit:function(e){var t=!0;if(e&&"accepted"===e.receive_status.key)switch(this.auditStatus[e.audit_status].key){case"wait_audit":case"rejected":t=!1}return t},isDisableProjectAuditPass:function(e){var t=!0;return e&&"auditing"===this.auditStatus[e.audit_status].key&&(t=!1),t},isDisableProjectAuditReject:function(e){var t=!0;return e&&"auditing"===this.auditStatus[e.audit_status].key&&(t=!1),t},isDisableProjectAccept:function(e){var t=!0;return e&&e.receive_status&&"wait_accept"===e.receive_status.key&&(t=!1),t},isDisableProjectReject:function(e){var t=!0;return e&&e.receive_status&&"wait_accept"===e.receive_status.key&&(t=!1),t},isDisableProjectCheckSubmit:function(e){var t=!0;if(e&&e.receive_status)switch(e.receive_status.key){case"finished":case"check_rejected":t=!1}return t},isDisableProjectCheckPass:function(e){var t=!0;return e&&e.receive_status&&"wait_check"===e.receive_status.key&&(t=!1),t},isDisableProjectCheckReject:function(e){var t=!0;return e&&e.receive_status&&"wait_check"===e.receive_status.key&&(t=!1),t},initStatus:function(){this.getProjectStatus(),this.getAuditStatus()},getProjectStatus:function(){var e=this;Object(n.o)().then(function(t){t&&t.length>0?(e.projectStatus=t,e.projectStatusMap=e.arrayToMap(t,"key"),e.projectStatus.forEach(function(e){e.value=e.text})):e.projectStatus=[]}).catch(function(e){console.log(e)})},getAuditStatus:function(){var e=this;Object(l.e)("ART_AUDIT_STATUS").then(function(t){t&&t.length>0&&(e.auditStatus=t[0].ART_AUDIT_STATUS,e.auditStatus&&e.auditStatus.length>0?e.auditStatus.forEach(function(e){e.text=e.value}):e.auditStatus=[])}).catch(function(e){console.log(e)})},getReasonTypes:function(){var e=this;Object(c.a)().then(function(t){e.reasonType=t||[],e.reasonTypeMap=e.arrayToMap(t,"key")}).catch(function(e){console.log(e)})},setDefaultActiveTab:function(){this.checkPermission(["admin","role_all","role_project_auditor"])?this.activeName="all":this.checkPermission(["admin","role_all","role_business_manager"])?this.activeName="all":(this.checkPermission(["admin","role_all","role_project_manager"]),this.activeName="all")},handleTabClick:function(e,t){this.activeName=e.name,delete this.query.receive_status,delete this.query.audit_status,this.getData(this.activeName)},getData:function(e){switch(e){case"all":break;case"wait_audit":this.query.audit_status=0;break;case"auditing":this.query.audit_status=1;break;case"audited":this.query.audit_status=2;break;case"audit_rejected":this.query.audit_status=3;break;default:this.projectStatusMap&&this.projectStatusMap[e]&&(this.query.receive_status=this.projectStatusMap[e].id)}this.init()},parseTime:u.b,checkPermission:o.a,beforeInit:function(){this.url="api/v1/art_projects/";var e=this.query,t=e.value;return this.params=s()({page:this.page,size:this.size,ordering:"id"},e),t&&(this.params.search=t),!0},afterInit:function(e){return this.formatData(e)},subDelete:function(e){var t=this;this.delLoading=!0,Object(n.e)(e).then(function(a){t.delLoading=!1,t.$refs[e].doClose(),t.init(),t.$message({showClose:!0,type:"success",message:"删除成功!",duration:2500})}).catch(function(a){t.delLoading=!1,t.$refs[e].doClose(),console.log(a)})},filterHandler:function(e,t,a){return t[a.property]===e},formatData:function(e){var t=this;return e&&e.length>0&&e.forEach(function(e){e.name=e.name||"",e.style=e.style||"",e.customer=e.customer||"",e.sender_name=e.sender?e.sender.name:"",e.receiver_name=e.receiver?e.receiver.name:"",e.auditor_name=e.auditor?e.auditor.name:"",e.add_time=e.add_time?m()(e.add_time).format("YYYY-MM-DD hh:mm:ss"):"",e.begin_time=e.begin_time?m()(e.begin_time).format("YYYY-MM-DD"):"",e.end_time=e.end_time?m()(e.end_time).format("YYYY-MM-DD"):"",e.finish_time=e.finish_time?m()(e.finish_time).format("YYYY-MM-DD"):"",e.finish_time?(e.delta_time=m()(e.end_time).diff(m()(e.finish_time),"days"),e.delta_time>0?e.lead_time=Math.abs(e.delta_time):e.delay_time=Math.abs(e.delta_time)):(e.delta_time=m()(e.end_time).diff(m()(),"days"),e.delta_time<0&&(e.delay_time=Math.abs(e.delta_time))),e.duration=Math.abs(new Date(e.end_time)-new Date(e.begin_time))/864e5+1,e.points=e.points||0,e.project_status_text=e.receive_status?e.receive_status.text:"",e.audit_status_text=t.auditStatus[e.audit_status].text,e.progress=e.progress+"%"}),e},arrayToMap:function(e,t){if(e&&e.length>0){var a={};return e.map(function(e,i){t?a[e[t]]=e:a[e[i]]=e}),a}},toTask:function(e,t,a){this.$router.push({path:"/art_business/art_project/detail",query:{id:e.id}}),this.$store.dispatch("setProject",e)},handleProjectAuditSubmit:function(e){var t=this;e===this.auditors[0].name&&(this.auditor=this.auditors[0].id);var a={project_id:this.project_id,auditor_id:this.auditor,sender_id:this.sender_id};Object(n.s)(a).then(function(e){200===e.code&&(t.$message.success("项目审核提交成功"),t.dialogProjectAuditSubmitVisible=!1,t.init())})},handleProjectAuditPass:function(){var e=this,t={points:0,project_id:this.project_id};Object(n.q)(t).then(function(t){if(200===t.code){if(e.$message.success("项目审核通过"),e.dialogProjectAuditPassVisible=!1,e.activeName)return void e.getData(e.activeName);e.init()}})},handleProjectAuditReject:function(){var e=this,t={project_id:this.project_id,reason:this.projectAuditRejectReason};Object(n.r)(t).then(function(t){200===t.code&&(e.$message.success("项目已驳回"),e.dialogProjectAuditRejectVisible=!1,e.init())})},handleProjectAccept:function(e){var t=this;Object(n.p)({project_id:e.row.id}).then(function(a){200===a.code&&(t.$refs[e.row.id].doClose(),t.$message({showClose:!0,type:"success",message:"项目接手成功",duration:2500}),t.init())})},handleProjectReject:function(){var e=this,t={project_id:this.project_id,reason:this.rejectReason||""};Object(n.w)(t).then(function(t){200===t.code&&(e.dialogProjectRejectVisible=!1,e.$message({showClose:!0,type:"success",message:"项目拒接成功",duration:2500}),e.init())})},handleProjectCheckSubmit:function(e){var t=this;Object(n.v)({project_id:e.row.id}).then(function(a){200===a.code&&(t.$refs[e.row.id].doClose(),t.$message({showClose:!0,type:"success",message:"项目验收提交成功",duration:2500}),t.init())})},handleProjectCheckPass:function(e){var t=this;Object(n.t)({project_id:e.row.id}).then(function(a){200===a.code&&(t.$refs[e.row.id].doClose(),t.$message({showClose:!0,type:"success",message:"项目验收成功",duration:2500}),t.init())})},handleProjectCheckReject:function(e){var t=this,a={project_id:e.row.id,reason:"项目验收不通过原因"};Object(n.u)(a).then(function(a){200===a.code&&(t.$refs[e.row.id].doClose(),t.$message({showClose:!0,type:"success",message:"项目验收不通过提交成功",duration:2500}),t.init())})},open:function(e,t,a,i){var s=this;if(1===a)this.dialogProjectAuditSubmitVisible=!0,Object(n.j)().then(function(e){e&&(s.auditors=e,s.auditors.length&&(s.auditor=s.auditors[0].name),s.project_id=i.row.id,s.sender_id=i.row.sender.id)});else if(2===a){if(!i.row.receiver_name)return void this.$message.error("请选择项目负责人之后再提交!");this.dialogProjectAuditPassVisible=!0,this.project_id=i.row.id}else 3===a?(this.dialogProjectAuditRejectVisible=!0,this.project_id=i.row.id):"project_reject"===a?(this.dialogProjectRejectVisible=!0,this.project_id=i.row.id):"cost_analysis"===a?(this.dialogProjectCostAnalysisVisible=!0,this.project_id=i.row.id):"task_publish"===a&&(this.dialogProjectIssueVisible=!0,this.project_id=i.row.id)},getRowKeys:function(e){return e.id},handleExpandChange:function(e,t){var a=this;t.length>1&&this.data.forEach(function(t){t.id!==e.id&&a.$refs.tables.toggleRowExpansion(t,!1)})},handleRowClick:function(e,t,a){this.$refs.tables.toggleRowExpansion(e)},tableRowClassName:function(e){var t=e.row,a=(e.rowIndex,"");if(3===t.audit_status)a="warning-row";else if(2===t.audit_status)switch(t.receive_status.key){case"rejected":case"check_rejected":a="warning-row";break;case"checked":a="success-row"}return a},switchDialogCostAnalysisVisible:function(e){this.dialogProjectCostAnalysisVisible=e}}},v=(a("gqnP"),a("kd3Q"),a("KHd+")),j=Object(v.a)(b,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("eHeader",{staticStyle:{clear:"both"},attrs:{projects:e.projects,query:e.query}}),e._v(" "),a("el-container",{staticStyle:{clear:"both"}},[a("el-aside",{attrs:{width:"90px"}},[e.checkPermission(["admin","role_all","role_business_manager"])?a("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"所有",name:"all"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"待接",name:"wait_accept"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已接",name:"accepted"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已拒接",name:"rejected"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已验收",name:"checked"}})],1):e.checkPermission(["admin","role_all","role_project_auditor"])?a("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"所有",name:"all"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"待审核",name:"auditing"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已审核",name:"audited"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已驳回",name:"audit_rejected"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"待接",name:"wait_accept"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已接",name:"accepted"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已完成",name:"finished"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已拒接",name:"rejected"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"待验收",name:"wait_check"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已验收",name:"checked"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"不通过",name:"check_rejected"}})],1):e.checkPermission(["admin","role_all","role_project_manager"])?a("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"所有",name:"all"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"待接",name:"wait_accept"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已接",name:"accepted"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已拒接",name:"rejected"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已完成",name:"finished"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"待验收",name:"wait_check"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已验收",name:"checked"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"不通过",name:"check_rejected"}})],1):e._e()],1),e._v(" "),a("el-main",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tables",staticStyle:{width:"100%"},attrs:{data:e.data,"expand-row-keys":e.expands,"row-class-name":e.tableRowClassName,"row-key":e.getRowKeys,fit:"","highlight-current-row":"",size:"small"},on:{"expand-change":e.handleExpandChange,"row-click":e.handleRowClick}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand project-detail",attrs:{size:"mini"}},[a("div",{staticClass:"project-detail-left"},[a("el-form-item",{attrs:{label:"项目名称："}},[a("span",[e._v(e._s(t.row.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"风格："}},[a("span",[e._v(e._s(t.row.style))])]),e._v(" "),a("el-form-item",{attrs:{label:"项目创建人："}},[a("span",[e._v(e._s(t.row.sender_name))])]),e._v(" "),a("el-form-item",{attrs:{label:"项目负责人："}},[a("span",[e._v(e._s(t.row.receiver_name))])]),e._v(" "),a("el-form-item",{attrs:{label:"客户："}},[a("span",[e._v(e._s(t.row.customer))])]),e._v(" "),e.checkPermission(["admin","project_all","project_points_view"])?a("el-form-item",{attrs:{label:"积分："}},[a("span",[e._v(e._s(t.row.points))])]):e._e(),e._v(" "),e.checkPermission(["admin","role_all","role_project_auditor"])?e._e():a("el-form-item",{attrs:{label:"项目审核员："}},[a("span",[e._v(e._s(t.row.auditor_name))])]),e._v(" "),a("el-form-item",{attrs:{label:"创建时间："}},[a("span",[e._v(e._s(t.row.add_time))])])],1),e._v(" "),a("div",{staticClass:"project-detail-right"},[a("el-form-item",{attrs:{label:"时限："}},[a("span",[e._v(e._s(t.row.duration))])]),e._v(" "),a("el-form-item",{attrs:{label:"开始时间："}},[a("span",[e._v(e._s(t.row.begin_time))])]),e._v(" "),a("el-form-item",{attrs:{label:"结束时间："}},[a("span",[e._v(e._s(t.row.end_time))])]),e._v(" "),a("el-form-item",{attrs:{label:"项目状态："}},[a("span",[e._v(e._s(t.row.project_status_text))])]),e._v(" "),e.checkPermission(["admin","role_all","role_business_manager"])?a("el-form-item",{attrs:{label:"审核状态："}},[a("span",[e._v(e._s(t.row.audit_status_text))])]):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"完成进度："}},[a("span",[e._v(e._s(t.row.progress))])])],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"项目名称",prop:"name",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"风格",prop:"style",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"客户",prop:"customer",width:"80"}}),e._v(" "),e.checkPermission(["role_all","role_project_manager"])?e._e():a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"项目负责人",prop:"receiver_name",width:"83"}}),e._v(" "),a("el-table-column",{attrs:{label:"时限（天）",prop:"duration",sortable:"",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{label:"开始时间",prop:"begin_time",sortable:"",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"结束时间",prop:"end_time",sortable:"",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"完成时间",prop:"finish_time",sortable:"",width:"100"}}),e._v(" "),e.checkPermission(["admin","project_all","project_points_view"])?a("el-table-column",{attrs:{label:"积分",prop:"points",sortable:"",width:"70"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{"filter-method":e.filterHandler,filters:e.projectStatus,"show-overflow-tooltip":!0,label:"项目状态",prop:"project_status_text",width:"128"},scopedSlots:e._u([{key:"default",fn:function(t){return["accepted"===t.row.receive_status.key?a("span",[e._v("\n              "+e._s(t.row.receive_status.text)+"\n              "),t.row.delay_time?a("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("过期"+e._s(t.row.delay_time)+"天")]):e._e()],1):"finished"===t.row.receive_status.key||"wait_check"===t.row.receive_status.key||"check_reject"===t.row.receive_status.key||"checked"===t.row.receive_status.key?a("span",[e._v("\n              "+e._s(t.row.receive_status.text)+"\n              "),t.row.lead_time?a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("提前"+e._s(t.row.lead_time)+"天")]):t.row.delay_time?a("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("过期"+e._s(t.row.delay_time)+"天")]):e._e()],1):"rejected"===t.row.receive_status.key||"check_rejected"===t.row.receive_status.key?a("span",[a("reject_reason",{attrs:{reason_type:"rejected"===t.row.receive_status.key?e.reasonTypeMap.project_reject:e.reasonTypeMap.project_check_reject,row:t.row}},[a("span",{attrs:{slot:"footer"},slot:"footer"},[e._v("\n                  "+e._s(t.row.receive_status.text)+"\n                  "),a("i",{staticClass:"el-icon-info"})])])],1):a("span",[e._v(e._s(t.row.receive_status.text))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"filter-method":e.filterHandler,filters:e.auditStatus,label:"审核状态",prop:"audit_status_text",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[3!==t.row.audit_status?a("span",[e._v(e._s(t.row.audit_status_text))]):a("span",[a("reject_reason",{attrs:{reason_type:e.reasonTypeMap.project_audit_reject,row:t.row}},[a("span",{attrs:{slot:"footer"},slot:"footer"},[e._v("\n                  "+e._s(t.row.audit_status_text)+"\n                  "),a("i",{staticClass:"el-icon-info"})])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"完成进度",prop:"progress",sortable:"",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","min-width":"420"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.checkPermission(["admin","project_all","project_edit"])?a("edit",{attrs:{data:t.row,disabled:e.isDisableProjectEdit(t.row),sup_this:e.sup_this}}):e._e(),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){a.stopPropagation(),e.toTask(t.row,t.column,t.$index)}}},[e._v("任务\n            ")]),e._v(" "),a("el-tooltip",{attrs:{effect:"light",placement:"top","popper-class":"btn-popper"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("el-button-group",[a("el-button",{attrs:{size:"mini"},on:{click:function(a){a.stopPropagation(),e.open("项目成本分析","","cost_analysis",t)}}},[e._v("成本分析\n                  ")]),e._v(" "),e.checkPermission(["admin","project_all","project_audit_pass"])?a("el-button",{attrs:{disabled:e.isDisableProjectAuditPass(t.row),size:"mini"},on:{click:function(a){a.stopPropagation(),e.open("项目审核通过","",2,t)}}},[e._v("审核通过\n                  ")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_audit_reject"])?a("el-button",{attrs:{disabled:e.isDisableProjectAuditReject(t.row),size:"mini"},on:{click:function(a){a.stopPropagation(),e.open("项目审核驳回","",3,t)}}},[e._v("审核驳回\n                  ")]):e._e()],1)],1),e._v(" "),e.checkPermission(["admin","project_all","project_audit"])?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(e){e.stopPropagation()}}},[e._v("审核\n              ")]):e._e()],1),e._v(" "),e.checkPermission(["admin","project_all","project_accept"])?a("el-button",{attrs:{disabled:e.isDisableProjectAccept(t.row),size:"mini",type:"success"},on:{click:function(a){a.stopPropagation(),e.handleProjectAccept(t)}}},[e._v("接手\n            ")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_reject"])?a("el-button",{attrs:{disabled:e.isDisableProjectReject(t.row),size:"mini",type:"success"},on:{click:function(a){a.stopPropagation(),e.open("项目拒接","","project_reject",t)}}},[e._v("拒接\n            ")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_audit_submit"])?a("el-button",{attrs:{disabled:e.isDisableProjectAuditSubmit(t.row),size:"mini",type:"success"},on:{click:function(a){a.stopPropagation(),e.open("项目提交审核","",1,t)}}},[e._v("提交审核\n            ")]):e._e(),e._v(" "),a("el-tooltip",{attrs:{effect:"light",placement:"top","popper-class":"btn-popper"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("el-button-group",[a("el-popover",{ref:t.row.id,attrs:{placement:"top",width:"160"}},[a("p",[e._v("确定验收通过吗？")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){e.$refs[t.row.id].doClose()}}},[e._v("取消\n                      ")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.handleProjectCheckPass(t)}}},[e._v("确定\n                      ")])],1),e._v(" "),e.checkPermission(["admin","project_all","project_check_pass"])?a("el-button",{attrs:{slot:"reference",disabled:e.isDisableProjectCheckPass(t.row),size:"mini"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("验收通过\n                    ")]):e._e()],1),e._v(" "),a("el-popover",{ref:t.row.id,attrs:{placement:"top",width:"160"}},[a("p",[e._v("确定验收通过吗？")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){e.$refs[t.row.id].doClose()}}},[e._v("取消\n                      ")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.handleProjectCheckReject(t)}}},[e._v("确定\n                      ")])],1),e._v(" "),e.checkPermission(["admin","project_all","project_check_reject"])?a("el-button",{attrs:{slot:"reference",disabled:e.isDisableProjectCheckReject(t.row),size:"mini"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("验收不通过\n                    ")]):e._e()],1)],1)],1),e._v(" "),e.checkPermission(["admin","project_all","project_check"])?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(e){e.stopPropagation()}}},[e._v("验收\n              ")]):e._e()],1),e._v(" "),e.checkPermission(["admin","project_all","project_check_submit"])?a("el-button",{attrs:{disabled:e.isDisableProjectCheckSubmit(t.row),size:"mini",type:"success"},on:{click:function(a){a.stopPropagation(),e.handleProjectCheckSubmit(t)}}},[e._v("提交验收\n            ")]):e._e(),e._v(" "),a("el-popover",{ref:t.row.id,attrs:{placement:"top",width:"180"}},[a("p",[e._v("确定删除本条数据吗？")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{loading:e.Loading,size:"mini",type:"primary"},on:{click:function(a){e.subDelete(t.row.id)}}},[e._v("确定\n                ")])],1),e._v(" "),e.checkPermission(["admin","project_all","project_delete"])?a("el-button",{attrs:{slot:"reference",disabled:e.isDisableProjectDelete(t.row),size:"mini",type:"danger"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("删除\n              ")]):e._e()],1)]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{"page-sizes":[10,20,30,40,50,100],total:e.total,layout:"total, prev, pager, next, sizes"},on:{"current-change":e.pageChange,"size-change":e.sizeChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"项目拒接",width:"450px",visible:e.dialogProjectRejectVisible},on:{"update:visible":function(t){e.dialogProjectRejectVisible=t}}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入拒接原因"},model:{value:e.rejectReason,callback:function(t){e.rejectReason=t},expression:"rejectReason"}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogProjectRejectVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleProjectReject()}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogProjectAuditSubmitVisible,width:"450px"},on:{"update:visible":function(t){e.dialogProjectAuditSubmitVisible=t}}},[e._v("\n    项目审核员：\n    "),a("el-select",{attrs:{placeholder:"请选择项目审核员",value:""},model:{value:e.auditor,callback:function(t){e.auditor=t},expression:"auditor"}},e._l(e.auditors,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogProjectAuditSubmitVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleProjectAuditSubmit(e.auditor)}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogProjectAuditPassVisible,title:"项目审核通过",width:"450px"},on:{"update:visible":function(t){e.dialogProjectAuditPassVisible=t}}},[a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogProjectAuditPassVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleProjectAuditPass()}}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogProjectAuditRejectVisible,title:"审核驳回",width:"450px"},on:{"update:visible":function(t){e.dialogProjectAuditRejectVisible=t}}},[a("el-input",{attrs:{rows:2,placeholder:"请输入驳回原因",type:"textarea"},model:{value:e.projectAuditRejectReason,callback:function(t){e.projectAuditRejectReason=t},expression:"projectAuditRejectReason"}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogProjectAuditRejectVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleProjectAuditReject()}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogProjectCostAnalysisVisible,title:"成本分析",width:"900px"},on:{"update:visible":function(t){e.dialogProjectCostAnalysisVisible=t}}},[a("cost_analysis",{attrs:{project_id:e.project_id},on:{switchDialogCostAnalysisVisible:e.switchDialogCostAnalysisVisible}})],1)],1)},[],!1,null,"4847574b",null);j.options.__file="index.vue";t.default=j.exports},F9iD:function(e,t,a){"use strict";a.d(t,"a",function(){return s}),a.d(t,"b",function(){return o});var i=a("t3Un");function s(){return Object(i.a)({url:"api/v1/reason_types",method:"get"})}function o(e){return Object(i.a)({url:"api/v1/reasons",method:"get",params:e})}},GqMO:function(e,t,a){"use strict";var i=a("3+Tn");a.n(i).a},OSA2:function(e,t,a){"use strict";var i=a("6oA6");a.n(i).a},"SkD+":function(e,t,a){"use strict";a.r(t);var i=a("41Be"),s=a("7Qib"),o=a("u/rA"),r=a("l9Yl"),n={components:{eForm:o.default},props:{query:{type:Object,required:!0}},data:function(){return{downloadLoading:!1,project_managers:[]}},methods:{checkPermission:i.a,toQuery:function(){this.$parent.page=1,this.$parent.init()},download:function(){var e=this;this.downloadLoading=!0,Promise.all([a.e("chunk-ef4a"),a.e("chunk-54ca")]).then(a.bind(null,"S/jZ")).then(function(t){var a=e.formatJson(["id","name","desc","index","weight"],e.$parent.data);t.export_json_to_excel({header:["ID","名称","描述","序号","权重"],data:a,filename:"table-list"}),e.downloadLoading=!1})},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return"createTime"===e?Object(s.b)(t[e]):t[e]})})}},created:function(){var e=this;Object(r.n)().then(function(t){t.length>0&&(e.project_managers=t)}).catch(function(e){console.log(e)})}},l=(a("GqMO"),a("KHd+")),c=Object(l.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"head-container"},[a("div",{staticClass:"project-head"},[a("div",{staticClass:"left"},[a("el-form",{attrs:{"label-position":"right","label-width":"86px",inline:!0,size:"mini"}},[a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"项目名称"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.toQuery(t):null}},model:{value:e.query.value,callback:function(t){e.$set(e.query,"value",t)},expression:"query.value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户",prop:"customer"}},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"客户"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.toQuery(t):null}},model:{value:e.query.customer,callback:function(t){e.$set(e.query,"customer",t)},expression:"query.customer"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"风格",prop:"style"}},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"风格"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.toQuery(t):null}},model:{value:e.query.style,callback:function(t){e.$set(e.query,"style",t)},expression:"query.style"}})],1),e._v(" "),e.checkPermission(["role_all","role_project_manager"])?e._e():a("el-form-item",{attrs:{label:"项目负责人",prop:"receiver_name"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",value:""},on:{change:e.toQuery},model:{value:e.query.receiver,callback:function(t){e.$set(e.query,"receiver",t)},expression:"query.receiver"}},e._l(e.project_managers,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"primary",plain:""},on:{click:e.toQuery}},[e._v("搜索\n        ")])],1)],1),e._v(" "),a("div",{staticClass:"right"},[a("div",{staticStyle:{display:"inline-block",margin:"0 2px"}},[e.checkPermission(["admin","project_all","project_create"])?a("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.$refs.form.dialog=!0}}},[e._v("新增\n        ")]):e._e(),e._v(" "),a("eForm",{ref:"form",attrs:{"is-add":!0}})],1),e._v(" "),e.checkPermission(["admin","project_all","project_import"])?a("el-button",{staticClass:"filter-item",attrs:{loading:e.downloadLoading,size:"mini",type:"primary",icon:"el-icon-download"},on:{click:e.download}},[e._v("导入\n      ")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_export"])?a("el-button",{staticClass:"filter-item",attrs:{loading:e.downloadLoading,size:"mini",type:"primary",icon:"el-icon-download"},on:{click:e.download}},[e._v("导出\n      ")]):e._e()],1)])])},[],!1,null,"4689d801",null);c.options.__file="header.vue";t.default=c.exports},UUqD:function(e,t,a){},c4Vh:function(e,t,a){},gqnP:function(e,t,a){"use strict";var i=a("4erX");a.n(i).a},kd3Q:function(e,t,a){"use strict";var i=a("pyjU");a.n(i).a},pYNO:function(e,t,a){"use strict";var i=a("c4Vh");a.n(i).a},pyjU:function(e,t,a){},qynV:function(e,t,a){"use strict";a.r(t);var i={components:{eForm:a("u/rA").default},props:{data:{type:Object,required:!0},sup_this:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},data:function(){return{}},methods:{to:function(){var e=this.$refs.form;e.form={id:this.data.id,name:this.data.name||"",style:this.data.style||"",customer:this.data.customer||"",manager:this.data.receiver?this.data.receiver.name:"",period:[this.data.begin_time,this.data.end_time]},e.dialog=!0}}},s=(a("0DB/"),a("KHd+")),o=Object(s.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{size:"mini",type:"success",disabled:e.disabled},on:{click:function(t){return t.stopPropagation(),e.to(t)}}},[e._v("编辑\n  ")]),e._v(" "),a("eForm",{ref:"form",attrs:{sup_this:e.sup_this,"is-add":!1,data:e.data}})],1)},[],!1,null,"e9aeb1f4",null);o.options.__file="edit.vue";t.default=o.exports},twU4:function(e,t,a){"use strict";a.d(t,"d",function(){return s}),a.d(t,"a",function(){return o}),a.d(t,"b",function(){return r}),a.d(t,"c",function(){return n}),a.d(t,"e",function(){return l});var i=a("t3Un");function s(){return Object(i.a)({url:"api/dict/tree/",method:"get"})}function o(e){return Object(i.a)({url:"api/dicts/",method:"post",data:e})}function r(e){return Object(i.a)({url:"api/dicts/"+e+"/",method:"delete"})}function n(e,t){return Object(i.a)({url:"api/dicts/"+e+"/",method:"put",data:t})}function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return Object(i.a)({url:"api/dicts/?&key="+t,method:"get"})}},"u/rA":function(e,t,a){"use strict";a.r(t);var i=a("l9Yl"),s={props:{isAdd:{type:Boolean,required:!0},sup_this:{type:Object,default:null},data:{type:Object,default:null}},data:function(){return{managers:[],loading:!1,dialog:!1,form:{name:"",style:"",customer:"",manager:null,period:[]},rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],style:[{required:!0,message:"请输入项目风格",trigger:"blur"}],customer:[{required:!0,message:"请输入客户名称",trigger:"blur"}],period:[{required:!0,message:"请输入项目完成时间范围",trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,e.isAdd?e.doAdd():e.doEdit()})},doAdd:function(){var e=this,t={name:this.form.name,style:this.form.style,customer:this.form.customer,begin_time:this.form.period[0],end_time:this.form.period[1],receiver:this.form.manager};Object(i.a)(t).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"添加成功!",duration:2500}),e.loading=!1,e.$parent.$parent.init()}).catch(function(t){e.loading=!1,console.log(t)})},doEdit:function(){var e=this,t={name:this.form.name,style:this.form.style,customer:this.form.customer,begin_time:this.form.period[0],end_time:this.form.period[1],receiver:this.form.manager};this.data&&this.data.receiver&&this.form.manager===this.data.receiver.name&&(t.receiver=this.data.receiver.id),Object(i.g)(this.form.id,t).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"修改成功!",duration:2500}),e.loading=!1,e.sup_this.init()}).catch(function(t){e.loading=!1,console.log(t)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={}},getAllProjectManagers:function(){var e=this;Object(i.n)().then(function(t){e.managers=t})},open:function(){this.getAllProjectManagers()}}},o=(a("OSA2"),a("KHd+")),r=Object(o.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{width:"480px","append-to-body":!0,visible:e.dialog,title:e.isAdd?"新增项目":"编辑项目"},on:{"update:visible":function(t){e.dialog=t},open:e.open}},[a("el-form",{ref:"form",attrs:{size:"small","label-width":"96px",model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{staticStyle:{width:"338px"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"风格",prop:"style"}},[a("el-input",{staticStyle:{width:"338px"},model:{value:e.form.style,callback:function(t){e.$set(e.form,"style",t)},expression:"form.style"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户",prop:"customer"}},[a("el-input",{staticStyle:{width:"338px"},model:{value:e.form.customer,callback:function(t){e.$set(e.form,"customer",t)},expression:"form.customer"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目负责人",prop:"manager"}},[a("el-select",{staticStyle:{width:"338px"},attrs:{placeholder:"请选择",clearable:"",value:""},model:{value:e.form.manager,callback:function(t){e.$set(e.form,"manager",t)},expression:"form.manager"}},e._l(e.managers,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"时间范围",prop:"period"}},[a("el-date-picker",{staticStyle:{width:"338px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.form.period,callback:function(t){e.$set(e.form,"period",t)},expression:"form.period"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)},[],!1,null,"8d80409c",null);r.options.__file="form.vue";t.default=r.exports}}]);