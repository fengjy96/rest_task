(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7a43","chunk-3276","chunk-6d04"],{"3ADX":function(t,e,r){"use strict";var o=r("14Xm"),n=r.n(o),i=r("4d7F"),a=r.n(i),s=r("D3Ub"),l=r.n(s),c=r("t3Un");function u(t,e,r){return Object(c.a)({url:t,method:"get",params:e,isMock:r})}var p=r("LvDl"),m=r.n(p);e.a={data:function(){return{loading:!0,rawData:[],data:[],page:1,size:10,total:0,url:"",params:{},query:{},time:170}},methods:{init:m.a.throttle(function(){var t=l()(n.a.mark(function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.beforeInit();case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:return t.abrupt("return",new a.a(function(t,o){e.loading=!0,u(e.url,e.params,r).then(function(r){e.total=r.count,e.rawData=r.results,e.data=e.afterInit?e.afterInit(r.results):e.rawData,setTimeout(function(){e.loading=!1},e.time),t(r)}).catch(function(t){e.loading=!1,o(t)})}));case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),1e3),beforeInit:function(){return!0},pageChange:function(t){this.page=t,this.init()},sizeChange:function(t){this.page=1,this.size=t,this.init()}}}},"3dkx":function(t,e,r){},"41Be":function(t,e,r){"use strict";r.d(e,"a",function(){return n});var o=r("Q2AE");function n(t){if(t&&t instanceof Array&&t.length>0){var e=t;return!!(o.a.getters&&o.a.getters.roles).some(function(t){return e.includes(t)})}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},C3Ep:function(t,e,r){"use strict";var o=r("uV/m");r.n(o).a},FmqJ:function(t,e,r){},LbrR:function(t,e,r){"use strict";r.r(e);var o=r("l9Yl"),n={props:{isAdd:{type:Boolean,required:!0},sup_this:{type:Object,default:null}},data:function(){return{managers:[],loading:!1,dialog:!1,form:{id:"",name:"",type:"",points:""},rules:{points:[{required:!0,message:"请输入积分",trigger:"blur"},{type:"number",message:"请输入数字"}]}}},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.loading=!0,t.isAdd?t.doAdd():t.doEdit()})},doAdd:function(){},doEdit:function(){var t=this;Object(o.h)(this.form.id,this.form).then(function(e){t.resetForm(),t.$message({showClose:!0,type:"success",message:"修改成功!",duration:2500}),t.loading=!1,t.sup_this.init(!0)}).catch(function(e){t.loading=!1,console.log(e)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={}}}},i=(r("Nqfd"),r("KHd+")),a=Object(i.a)(n,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{width:"480px","append-to-body":!0,visible:t.dialog,title:t.isAdd?"新增积分":"编辑积分"},on:{"update:visible":function(e){t.dialog=e}}},[r("el-form",{ref:"form",attrs:{size:"small","label-width":"96px",model:t.form,rules:t.rules}},[r("el-form-item",{attrs:{label:"姓名",prop:"name"}},[r("el-input",{staticStyle:{width:"338px"},attrs:{disabled:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"类型",prop:"type"}},[r("el-input",{staticStyle:{width:"338px"},attrs:{disabled:""},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"积分",prop:"points"}},[r("el-input",{staticStyle:{width:"338px"},model:{value:t.form.points,callback:function(e){t.$set(t.form,"points",t._n(e))},expression:"form.points"}})],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"text"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),r("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.doSubmit}},[t._v("确认")])],1)],1)},[],!1,null,"572f8e10",null);a.options.__file="form.vue";e.default=a.exports},Nqfd:function(t,e,r){"use strict";var o=r("3dkx");r.n(o).a},QUGg:function(t,e,r){"use strict";r.r(e);var o=r("QbLZ"),n=r.n(o),i=r("41Be"),a=r("ZBwJ"),s=r("3ADX"),l=r("l9Yl"),c={components:{edit:a.default},mixins:[s.a],props:{project_id:{type:Number,required:!0}},computed:{totalCost:function(){return this.$store.state.project.totalCost}},data:function(){return{grossProfitForm:{projectTotalFee:"",totalCost:this.$store.state.project.totalCost},grossProfitFormRules:{projectTotalFee:[{required:!0,message:"请输入项目总费用",trigger:"blur"}],totalCost:[{required:!0,message:"请输入项目总成本",trigger:"blur"}]},grossPointForm:{grossProfit:"",projectPointRate:""},grossPointFormRules:{grossProfit:[{required:!0,message:"请输入项目总利润",trigger:"blur"}],projectPointRate:[{required:!0,message:"请输入项目积分比",trigger:"blur"}]},pointsForm:{projectTotalPoint:"",projectManagerPointRate:"",businessManagerPointRate:""},pointsFormRules:{projectTotalPoint:[{required:!0,message:"请输入项目总积分",trigger:"blur"}],projectManagerPointRate:[{required:!0,message:"请输入项目负责人积分比",trigger:"blur"}],businessManagerPointRate:[{required:!0,message:"请输入商务人员积分比",trigger:"blur"}]},points:[],sup_this:this,Loading:!1,delLoading:!1,distinguishCancelAndClose:!1}},watch:{project_id:function(){this.query.project_id=this.project_id}},created:function(){this.query.project_id=this.project_id,this.grossProfitForm.totalCost=this.$store.state.project.totalCost},methods:{beforeInit:function(){this.url="api/v1/points/assignment";var t=this.query,e=t.value;return this.params=n()({page:this.page,size:this.size,ordering:"id"},t),e&&(this.params.search=e),!0},afterInit:function(t){return this.formatData(t)},getGrossProfit:function(){var t=this;this.$refs.grossProfitForm.validate(function(e){if(!e)return!1;t.grossPointForm.grossProfit=parseInt(t.grossProfitForm.projectTotalFee-t.grossProfitForm.totalCost)})},getGrossPoint:function(){var t=this;this.$refs.grossPointForm.validate(function(e){if(!e)return!1;t.pointsForm.projectTotalPoint=parseInt(t.grossPointForm.grossProfit*t.grossPointForm.projectPointRate/100)})},assignProjectPoint:function(){var t=this,e={project_id:this.project_id,project_receiver_percentage:this.pointsForm.projectManagerPointRate||0,project_sender_percentage:this.pointsForm.businessManagerPointRate||0,project_points:this.pointsForm.projectTotalPoint||0};this.$refs.pointsForm.validate(function(r){if(!r)return!1;Object(l.c)(e).then(function(e){console.log("res",e),t.init(),e&&e.results&&e.results.length>0?t.points=t.formatData(e.results)||[]:t.points=[]}).catch(function(t){console.log(t)})})},checkPermission:i.a,formatData:function(t){return console.log("raw_data",t),t&&t.length>0&&t.forEach(function(t){t.name=t.user.name||"",t.type_name=0===t.type?"项目":"任务",t.type=t.type||0,t.points=t.points||"",t.project=t.project||"",t.project&&(t.project.duration=Math.abs(new Date(t.project.end_time)-new Date(t.project.begin_time))/864e5),t.task=t.task||"",t.task&&(t.task.duration=Math.abs(new Date(t.task.end_time)-new Date(t.task.begin_time))/864e5,t.task.type=t.task.task_type.name||"",t.task.priority=t.task.task_priority.name||"",t.task.quality=t.task.task_quality.name||"",t.task.content=t.task.content||"")}),t},open:function(t,e,r,o){this.$confirm(t,e+"详情",{distinguishCancelAndClose:!0}).then(function(){}).catch(function(){})}}},u=(r("C3Ep"),r("KHd+")),p=Object(u.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"points"},[r("div",{staticClass:"points-container",staticStyle:{width:"70%",margin:"0 auto"}},[r("el-form",{ref:"grossProfitForm",staticClass:"demo-form-inline",attrs:{size:"mini",inline:!0,rules:t.grossProfitFormRules,model:t.grossProfitForm}},[r("el-form-item",{attrs:{label:"项目总费用",prop:"projectTotalFee"}},[r("el-input",{attrs:{placeholder:"请输入项目总费用"},model:{value:t.grossProfitForm.projectTotalFee,callback:function(e){t.$set(t.grossProfitForm,"projectTotalFee",t._n(e))},expression:"grossProfitForm.projectTotalFee"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"项目总成本",prop:"totalCost"}},[r("el-input",{attrs:{placeholder:""},model:{value:t.grossProfitForm.totalCost,callback:function(e){t.$set(t.grossProfitForm,"totalCost",t._n(e))},expression:"grossProfitForm.totalCost"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:t.getGrossProfit}},[t._v("计算项目总利润")])],1)],1),t._v(" "),r("el-divider",[r("i",{staticClass:"el-icon-caret-bottom"})]),t._v(" "),r("el-form",{ref:"grossPointForm",staticClass:"demo-form-inline",attrs:{size:"mini",inline:!0,rules:t.grossPointFormRules,model:t.grossPointForm}},[r("el-form-item",{attrs:{label:"项目总利润",prop:"grossProfit"}},[r("el-input",{attrs:{placeholder:""},model:{value:t.grossPointForm.grossProfit,callback:function(e){t.$set(t.grossPointForm,"grossProfit",t._n(e))},expression:"grossPointForm.grossProfit"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"积分百分比",prop:"projectPointRate"}},[r("el-input",{attrs:{placeholder:"请输入积分百分比"},model:{value:t.grossPointForm.projectPointRate,callback:function(e){t.$set(t.grossPointForm,"projectPointRate",t._n(e))},expression:"grossPointForm.projectPointRate"}},[r("template",{slot:"append"},[t._v("%")])],2)],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:t.getGrossPoint}},[t._v("计算项目总积分")])],1)],1),t._v(" "),r("el-divider",[r("i",{staticClass:"el-icon-caret-bottom"})]),t._v(" "),r("el-form",{ref:"pointsForm",staticClass:"demo-form-inline",attrs:{size:"mini","label-width":"150px",rules:t.pointsFormRules,model:t.pointsForm}},[r("el-form-item",{attrs:{label:"项目总积分",prop:"projectTotalPoint"}},[r("el-input",{attrs:{placeholder:""},model:{value:t.pointsForm.projectTotalPoint,callback:function(e){t.$set(t.pointsForm,"projectTotalPoint",t._n(e))},expression:"pointsForm.projectTotalPoint"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"项目负责人百分比",prop:"projectManagerPointRate"}},[r("el-input",{attrs:{placeholder:"请输入项目负责人积分百分比"},model:{value:t.pointsForm.projectManagerPointRate,callback:function(e){t.$set(t.pointsForm,"projectManagerPointRate",t._n(e))},expression:"pointsForm.projectManagerPointRate"}},[r("template",{slot:"append"},[t._v("%")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"商务人员百分比",prop:"businessManagerPointRate"}},[r("el-input",{attrs:{placeholder:"请输入商务人员积分百分比"},model:{value:t.pointsForm.businessManagerPointRate,callback:function(e){t.$set(t.pointsForm,"businessManagerPointRate",t._n(e))},expression:"pointsForm.businessManagerPointRate"}},[r("template",{slot:"append"},[t._v("%")])],2)],1),t._v(" "),r("el-form-item",{staticStyle:{position:"relative",height:"30px"}},[r("el-button",{staticStyle:{position:"absolute",top:"0",right:"0"},attrs:{type:"primary"},on:{click:t.assignProjectPoint}},[t._v("积分分配\n        ")])],1)],1),t._v(" "),r("el-divider",[r("i",{staticClass:"el-icon-caret-bottom"})]),t._v(" "),r("div",[r("el-table",{staticClass:"points-table",attrs:{border:"","highlight-current-row":"",fit:"",size:"small",data:t.data}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.type?r("div",[r("el-form",{staticClass:"table-expand points-detail",attrs:{size:"mini"}},[r("div",{staticClass:"points-detail-left"},[r("el-form-item",{attrs:{label:"项目名称："}},[r("span",[t._v(t._s(e.row.project.name))])]),t._v(" "),r("el-form-item",{attrs:{label:"风格："}},[r("span",[t._v(t._s(e.row.project.style))])]),t._v(" "),r("el-form-item",{attrs:{label:"客户："}},[r("span",[t._v(t._s(e.row.project.customer))])])],1),t._v(" "),r("div",{staticClass:"points-detail-right"},[r("el-form-item",{attrs:{label:"时限（天）："}},[r("span",[t._v(t._s(e.row.project.duration))])]),t._v(" "),r("el-form-item",{attrs:{label:"开始时间："}},[r("span",[t._v(t._s(e.row.project.begin_time))])]),t._v(" "),r("el-form-item",{attrs:{label:"结束时间："}},[r("span",[t._v(t._s(e.row.project.end_time))])])],1)])],1):1===e.row.type?r("div",[r("el-form",{staticClass:"table-expand points-detail",attrs:{size:"mini"}},[r("div",{staticClass:"points-detail-left"},[r("el-form-item",{attrs:{label:"任务名称："}},[r("span",[t._v(t._s(e.row.task.name))])]),t._v(" "),r("el-form-item",{attrs:{label:"类型："}},[r("span",[t._v(t._s(e.row.task.type))])]),t._v(" "),r("el-form-item",{attrs:{label:"优先级："}},[r("span",[t._v(t._s(e.row.task.priority))])]),t._v(" "),r("el-form-item",{attrs:{label:"品质要求："}},[r("span",[t._v(t._s(e.row.task.quality))])])],1),t._v(" "),r("div",{staticClass:"points-detail-right"},[r("el-form-item",{attrs:{label:"时限（天）："}},[r("span",[t._v(t._s(e.row.task.duration))])]),t._v(" "),r("el-form-item",{attrs:{label:"开始时间："}},[r("span",[t._v(t._s(e.row.task.begin_time))])]),t._v(" "),r("el-form-item",{attrs:{label:"结束时间："}},[r("span",[t._v(t._s(e.row.task.end_time))])]),t._v(" "),r("el-form-item",{attrs:{label:"内容："}},[r("el-button",{attrs:{type:"text"},on:{click:function(r){t.open(e.row.task.content,"内容")}}},[t._v("点击显示内容详情")])],1)],1)])],1):t._e()]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t._v(" "),r("el-table-column",{attrs:{prop:"type_name",label:"类型"}}),t._v(" "),r("el-table-column",{attrs:{prop:"points",label:"积分"}})],1),t._v(" "),r("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{"page-sizes":[10,20,30,40,50,100],total:t.total,layout:"total, prev, pager, next, sizes"},on:{"current-change":t.pageChange,"size-change":t.sizeChange}})],1)],1)])},[],!1,null,"5a52d28b",null);p.options.__file="index.vue";e.default=p.exports},UAz3:function(t,e,r){"use strict";var o=r("FmqJ");r.n(o).a},ZBwJ:function(t,e,r){"use strict";r.r(e);var o={components:{eForm:r("LbrR").default},props:{data:{type:Object,required:!0},sup_this:{type:Object,required:!0}},data:function(){return{}},methods:{to:function(){var t=this.$refs.form;t.form={name:this.data.name,type:this.data.type,points:this.data.points},t.dialog=!0}}},n=(r("UAz3"),r("KHd+")),i=Object(n.a)(o,function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("el-button",{attrs:{size:"mini",type:"success"},on:{click:this.to}},[this._v("编辑")]),this._v(" "),e("eForm",{ref:"form",attrs:{sup_this:this.sup_this,"is-add":!1}})],1)},[],!1,null,"5e7876aa",null);i.options.__file="edit.vue";e.default=i.exports},l9Yl:function(t,e,r){"use strict";r.d(e,"a",function(){return n}),r.d(e,"e",function(){return i}),r.d(e,"g",function(){return a}),r.d(e,"n",function(){return s}),r.d(e,"j",function(){return l}),r.d(e,"s",function(){return c}),r.d(e,"r",function(){return u}),r.d(e,"q",function(){return p}),r.d(e,"p",function(){return m}),r.d(e,"v",function(){return d}),r.d(e,"u",function(){return f}),r.d(e,"t",function(){return g}),r.d(e,"w",function(){return h}),r.d(e,"m",function(){return v}),r.d(e,"f",function(){return b}),r.d(e,"i",function(){return _}),r.d(e,"b",function(){return j}),r.d(e,"k",function(){return P}),r.d(e,"l",function(){return F}),r.d(e,"d",function(){return y}),r.d(e,"c",function(){return k}),r.d(e,"h",function(){return w}),r.d(e,"o",function(){return C});var o=r("t3Un");function n(t){return Object(o.a)({url:"api/v1/art_projects/",method:"post",data:t})}function i(t){return Object(o.a)({url:"api/v1/art_projects/"+t+"/",method:"delete"})}function a(t,e){return Object(o.a)({url:"api/v1/art_projects/"+t+"/",method:"put",data:e})}function s(){return Object(o.a)({url:"api/v1/project/receivers",method:"get"})}function l(){return Object(o.a)({url:"api/v1/project/auditors",method:"get"})}function c(t){return Object(o.a)({url:"api/v1/project/audit/submit",method:"post",data:t})}function u(t){return Object(o.a)({url:"api/v1/project/audit/reject",method:"post",data:t})}function p(t){return Object(o.a)({url:"api/v1/project/audit/pass",method:"post",data:t})}function m(t){return Object(o.a)({url:"api/v1/project/accept",method:"post",data:t})}function d(t){return Object(o.a)({url:"api/v1/project/check/submit",method:"post",data:t})}function f(t){return Object(o.a)({url:"api/v1/project/check/reject",method:"post",data:t})}function g(t){return Object(o.a)({url:"api/v1/project/check/pass",method:"post",data:t})}function h(t){return Object(o.a)({url:"api/v1/project/reject",method:"post",data:t})}function v(t){return Object(o.a)({url:"/api/v1/project_fee",method:"get",params:t})}function b(t){return Object(o.a)({url:"/api/v1/project_fee/"+t+"/",method:"delete"})}function _(t,e){return Object(o.a)({url:"/api/v1/project_fee/"+t+"/",method:"put",data:e})}function j(t){return Object(o.a)({url:"/api/v1/project_fee/",method:"post",data:t})}function P(t){return Object(o.a)({url:"/api/v1/project/cost/analysis",method:"get",params:t})}function F(t){return Object(o.a)({url:"/api/v1/project/fee/cost/analysis",method:"get",params:t})}function y(t){return Object(o.a)({url:"api/v1/project/cost/analysis/finished",method:"post",data:t})}function k(t){return Object(o.a)({url:"api/v1/points/assignment",method:"post",data:t})}function w(t,e){return Object(o.a)({url:"/points/"+t+"/",method:"put",data:e,isMock:!0})}function C(){return Object(o.a)({url:"/api/v1/project_statuses",method:"get"})}},"uV/m":function(t,e,r){}}]);