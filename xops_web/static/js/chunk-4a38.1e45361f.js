(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4a38"],{"12zi":function(e,t,r){"use strict";var n=r("7wq9");r.n(n).a},"3ADX":function(e,t,r){"use strict";var n=r("14Xm"),o=r.n(n),i=r("4d7F"),a=r.n(i),s=r("D3Ub"),l=r.n(s),c=r("t3Un");function u(e,t,r){return Object(c.a)({url:e,method:"get",params:t,isMock:r})}var d=r("LvDl"),f=r.n(d);t.a={data:function(){return{loading:!0,rawData:[],data:[],page:1,size:10,total:0,url:"",params:{},query:{},time:170}},methods:{init:f.a.throttle(function(){var e=l()(o.a.mark(function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.beforeInit();case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new a.a(function(e,n){t.loading=!0,u(t.url,t.params,r).then(function(r){t.total=r.count,t.rawData=r.results,t.data=t.afterInit?t.afterInit(r.results):t.rawData,setTimeout(function(){t.loading=!1},t.time),e(r)}).catch(function(e){t.loading=!1,n(e)})}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),1e3),beforeInit:function(){return!0},pageChange:function(e){this.page=e,this.init()},sizeChange:function(e){this.page=1,this.size=e,this.init()}}}},"41Be":function(e,t,r){"use strict";r.d(t,"a",function(){return o});var n=r("Q2AE");function o(e){if(e&&e instanceof Array&&e.length>0){var t=e;return!!(n.a.getters&&n.a.getters.roles).some(function(e){return t.includes(e)})}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},"7wq9":function(e,t,r){},BN8A:function(e,t,r){"use strict";r.r(t);var n=r("Qdvm"),o=r("3ADX"),i=r("JNL0"),a=r("qpgI"),s=r("41Be"),l=r("7Qib"),c={mixins:[o.a],data:function(){return{formloading:!1,rollbackloading:!1,changeFlag:!1,vers:null,host_radio:"true",hosts:[],records:[],form:{name:"",alias:"",environment:"",version:"",server_ids:""},rules:{version:[{required:!0,message:"请选择版本",trigger:"blur"}]}}},created:function(){var e=this;Object(a.c)("Linux").then(function(t){e.hosts=t}),this.$nextTick(function(){e.publishInit(),e.init()})},methods:{parseTime:l.b,checkPermission:s.a,beforeInit:function(){this.url="api/deploy/records/?project_id="+this.$route.query.id;return this.params={page:this.page,size:this.size,ordering:"-id"},!0},publishInit:function(){var e=this;Object(i.e)(this.$route.query.id).then(function(t){e.form.id=t.id,e.form.name=t.name,e.form.alias=t.alias,e.form.environment=t.environment,e.form.server_ids=t.server_ids,e.form.server_ids=e.form.server_ids.split(",")})},cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.formloading=!0,e.form.excu="deploy",Object(n.c)(e.form).then(function(t){e.formloading=!1,e.$router.push({path:"/deploy/tasks/console",query:{id:e.$route.query.id,alias:e.form.alias,record:t.detail,scenario:0}})}).catch(function(t){e.formloading=!1,console.log(t)})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={name:"",alias:"",environment:"",version:"",server_ids:""}},toRollback:function(e,t,r){var o=this;this.$confirm("是否回滚到上一个版本?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.rollbackloading=!0;var i={excu:"rollback",id:e,project_id:t,alias:r};Object(n.c)(i).then(function(e){o.rollbackloading=!1,o.$router.push({path:"/deploy/tasks/console",query:{id:o.$route.query.id,alias:r,record:e.detail,scenario:1}})}).catch(function(e){console.log(e)})}).catch(function(){o.$message({type:"info",message:"取消操作"})})},toDetail:function(e,t){var r=new RegExp(e+"_(.*\\d)","");t=t.match(r),this.$router.push({path:"/deploy/tasks/console",query:{id:this.$route.query.id,alias:e,record:t[0],scenario:1}})},closeTag:function(){this.$store.dispatch("delView",this.$store.state.tagsView.visitedViews.slice(-1)[0]),this.$router.go(-1)},getVersion:function(e,t){var r=this;e&&null===this.vers&&(this.changeFlag=!0,Object(n.d)(t).then(function(e){var t=r;t.vers=[],e.detail.forEach(function(e,r){t.vers.push({id:r,value:e})}),r.changeFlag=!1}))}}},u=(r("12zi"),r("KHd+")),d=Object(u.a)(c,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page"},[r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:9}},[r("el-card",{staticClass:"box-card"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"80px"}},[r("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[r("el-input",{staticStyle:{width:"230px"},attrs:{readonly:!0},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"项目别名",prop:"alias"}},[r("el-input",{staticStyle:{width:"230px"},attrs:{readonly:!0},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"部署环境",prop:"environment"}},[r("el-input",{staticStyle:{width:"230px"},attrs:{readonly:!0},model:{value:e.form.environment,callback:function(t){e.$set(e.form,"environment",t)},expression:"form.environment"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"选择版本",prop:"version"}},[r("el-select",{staticStyle:{width:"230px"},attrs:{loading:e.changeFlag,placeholder:"请选择版本"},on:{"visible-change":function(t){e.getVersion(t,e.$route.query.id)}},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}},e._l(e.vers,function(e){return r("el-option",{key:e.id,attrs:{label:e.value,value:e.value}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"服务器",prop:"server_ids"}},[r("el-radio",{attrs:{label:"true"},model:{value:e.host_radio,callback:function(t){e.host_radio=t},expression:"host_radio"}},[e._v("全量")]),e._v(" "),r("el-radio",{attrs:{label:"false"},model:{value:e.host_radio,callback:function(t){e.host_radio=t},expression:"host_radio"}},[e._v("自定义")]),e._v(" "),"true"!=e.host_radio?r("el-select",{staticStyle:{width:"230px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.form.server_ids,callback:function(t){e.$set(e.form,"server_ids",t)},expression:"form.server_ids"}},e._l(e.hosts,function(e){return r("el-option",{key:e.key,attrs:{label:e.label,value:e.key}})})):e._e()],1),e._v(" "),r("el-form-item",[r("div",{staticStyle:{display:"inline-block",margin:"0px 0px"}},[e.checkPermission(["admin","deploy_all","deploy_excu"])?r("el-button",{attrs:{loading:e.formloading,type:"primary"},on:{click:e.doSubmit}},[e._v("提交")]):e._e(),e._v(" "),e.checkPermission(["admin","deploy_all","deploy_excu"])?r("el-button",{on:{click:e.closeTag}},[e._v("返回")]):e._e()],1)])],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:15}},[r("el-card",[r("el-table",{attrs:{data:e.data,height:"226"}},[r("el-table-column",{attrs:{prop:"id",label:"ID",width:"70",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"历史记录"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){e.toDetail(t.row.alias,t.row.name)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["Succeed"==t.row.status?r("span",{staticStyle:{color:"#00CC00"}},[e._v("成功")]):r("span",{staticStyle:{color:"red"}},[e._v("失败")])]}}])}),e._v(" "),e.checkPermission(["admin","deploy_all","deploy_excu"])?r("el-table-column",{attrs:{label:"操作",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.is_rollback&&"Succeed"==t.row.status?r("el-button",{attrs:{loading:e.rollbackloading,size:"mini",type:"primary"},on:{click:function(r){e.toRollback(t.row.id,t.row.project_id,t.row.alias)}}},[e._v("回滚")]):e._e()]}}])}):e._e()],1),e._v(" "),r("el-pagination",{attrs:{total:e.total,background:"",layout:"prev, pager, next"},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)],1)],1),e._v(" "),r("el-row",[r("el-card",[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("项目统计")])])])],1)],1)},[],!1,null,"684d8499",null);d.options.__file="publish.vue";t.default=d.exports},JNL0:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"e",function(){return i}),r.d(t,"c",function(){return a}),r.d(t,"d",function(){return s}),r.d(t,"b",function(){return l});var n=r("t3Un");function o(e){return Object(n.a)({url:"api/projects/",method:"post",data:e})}function i(e){return Object(n.a)({url:"api/projects/"+e+"/",method:"get"})}function a(e){return Object(n.a)({url:"api/projects/"+e+"/",method:"delete"})}function s(e,t){return Object(n.a)({url:"api/projects/"+e+"/",method:"put",data:t})}function l(e){return Object(n.a)({url:"api/project/copy/",method:"post",data:e})}},Qdvm:function(e,t,r){"use strict";r.d(t,"c",function(){return o}),r.d(t,"d",function(){return i}),r.d(t,"b",function(){return a}),r.d(t,"a",function(){return s});var n=r("t3Un");function o(e){return Object(n.a)({url:"api/deploy/excu/",method:"post",data:e})}function i(e){return Object(n.a)({url:"api/deploy/ver/?id="+e,method:"get"})}function a(e){return Object(n.a)({url:"api/deploy/applog/",method:"post",data:e})}function s(e){return Object(n.a)({url:"api/deploy/applog/",method:"post",data:e,responseType:"blob"})}},qpgI:function(e,t,r){"use strict";r.d(t,"c",function(){return o}),r.d(t,"d",function(){return i}),r.d(t,"a",function(){return a}),r.d(t,"b",function(){return s});var n=r("t3Un");function o(e){return e?Object(n.a)({url:"api/device/list/?os_type="+e,method:"get"}):Object(n.a)({url:"api/device/list/",method:"get"})}function i(e){return Object(n.a)({url:"api/devices/"+e+"/",method:"get"})}function a(e){return Object(n.a)({url:"api/devices/"+e+"/",method:"delete"})}function s(e,t){return Object(n.a)({url:"api/devices/"+e+"/",method:"put",data:t})}}}]);